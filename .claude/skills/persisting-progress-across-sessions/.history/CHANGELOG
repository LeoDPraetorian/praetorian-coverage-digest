# Changelog - persisting-progress-across-sessions

## 2026-01-19 - Align with Unified MANIFEST.yaml State Management

**Changed:**
- Progress file location: `.claude/progress/<domain>-<feature>.md` → `.claude/.output/{type}/{id}/MANIFEST.yaml`
- Progress file format: Markdown → YAML (MANIFEST.yaml schema)
- Resume protocol: `ls .claude/progress/*.md` → `find .claude/.output -name 'MANIFEST.yaml' -mmin -1440`

**Updated:**
- SKILL.md: Quick Reference, Progress File Location, Progress File Structure, Resume Protocol, Integration with TodoWrite, Lifecycle Management, Anti-Patterns, Related Skills, References
- references/file-templates.md: Complete rewrite from markdown templates to YAML templates
- references/resume-checklist.md: Updated all commands and procedures for MANIFEST.yaml
- references/compaction-protocol.md: Updated "progress file" references to "MANIFEST.yaml"

**Added:**
- Integration Note explaining relationship with `persisting-agent-outputs` skill
- Link to persisting-agent-outputs/references/manifest-structure.md for field definitions
- `persisting-agent-outputs` (CORE) in Related Skills section
- `orchestrating-capability-development` in Related Skills section

**Removed:**
- References to `.claude/progress/` directory (never existed in practice)
- Markdown progress file format examples
- `archived/` subdirectory pattern (not used)

**Why:**
The skill documented a `.claude/progress/` directory pattern that:
1. No repos actually used (verified directory doesn't exist)
2. Conflicted with actual pattern: `.claude/.output/{type}/{id}/MANIFEST.yaml`
3. Was inconsistent with `persisting-agent-outputs` skill's MANIFEST.yaml schema

This update aligns the skill with the actual implementation, making it the PROTOCOL skill (when/how to persist) while `persisting-agent-outputs` provides the FORMAT (MANIFEST.yaml schema).

---

## 2026-01-16 - Context Compaction Protocol

**Added:**
- New section "Context Compaction Protocol" in SKILL.md
  - Explains difference between persistence (cross-session) and compaction (in-session)
  - Provides compaction triggers (message count, phase completion, agent output size, context usage)
  - Details 4-step compaction protocol (identify content, summarize phases, use file references, update progress file)
  - Includes pre-rot threshold monitoring table
  - Provides compaction checklist for phase transitions
- New reference file: references/compaction-protocol.md
  - Example 1: Summarizing Architecture Phase (before/after)
  - Example 2: Summarizing Discovery Phase (800+ tokens to 150 tokens)
  - Example 3: Multi-Phase Summary
  - Anti-patterns (compacting too aggressively, never compacting, compacting without persisting)
  - Step-by-step compaction workflow
  - Pre-rot threshold examples
  - Integration with orchestrations (feature-development, integration-development)
  - Compaction metrics table

**Updated:**
- Related Skills section: Added orchestrating-feature-development and orchestrating-integration-development with context compaction note
- References section: Added link to compaction-protocol.md

**Why:**
Addresses gap identified from Anthropic's context engineering research:
- Context rot occurs even within token limits
- Effective context window is ~256k tokens (not advertised 1M)
- Token usage accounts for 80% of performance variance
- Summarization at ~128k tokens prevents degradation

The skill previously only handled cross-session persistence (saving to files) but not in-session context compaction (reducing context window usage during long-running workflows).
