# Changelog

All notable changes to the auditing-skills skill.

## [2026-01-06] - Add Phase 28: Integration Section

### Added

**Phase 28: Integration Section** - New CRITICAL audit phase that validates skills have structured Integration sections.

**What it checks:**
- `## Integration` heading exists
- `### Called By` subsection present
- `### Requires (invoke before starting)` subsection present
- `### Calls (during execution)` subsection present
- `### Pairs With (conditional)` subsection present

**Severity:** CRITICAL - Missing Integration section blocks PASSED status

**Category:** Claude-Automated - Claude analyzes skill content to determine if Integration section is complete

**Why this phase exists:** Based on analysis of [obra/superpowers](https://github.com/obra/superpowers), skills with explicit Integration sections:
1. Are never orphaned (Called By shows what uses them)
2. Have clear dependencies (Requires documents prerequisites)
3. Form traceable chains (Calls shows full workflow)
4. Enable automated dependency checking

**Migration path:** Skills with "Related Skills" but no "Integration" section are flagged for migration.

**Files modified:**
- `SKILL.md` - Updated phase count from 27 to 28, added Phase 28 to tables
- `references/phase-details.md` - Added complete Phase 28 documentation

**Related changes:**
- `creating-skills` - Added Integration section guidance to Phase 5.2
- `fixing-skills` - Added Phase 28 fix procedure
- `SKILL-template.md` - Added Integration section to template

---

## [2026-01-04] - Add fixing-skills Workflow Option to Post-Audit Actions

### Changed

**Post-Audit Actions - Updated AskUserQuestion options:**
- Option 1: "Run fixing-skills workflow (Recommended)" - Claude fixes issues automatically using semantic reasoning
- Option 2: "Show me the issues" - View categorization, then re-prompts with same options

**Based on selection logic updated:**
- "Run fixing-skills workflow" now invokes the fixing-skills skill with audit findings
- "Show me the issues" displays categories then re-prompts (instead of dead-ending)

**Why:** Previous options only offered to SHOW categorization or skip fixes entirely. There was no path to actually INVOKE the fixing-skills workflow, which exists specifically for automated remediation with semantic reasoning.

**Impact:** Users now have a direct path to automated fixes after audit identifies issues.

**Files modified:**
- `SKILL.md:272-282` - Updated AskUserQuestion options and selection logic

## [2026-01-03] - Add AskUserQuestion Compliance Enforcement

### Changed

**Post-Audit Actions - Added layered compliance enforcement:**
- Success Criteria: Added item 7 "AskUserQuestion used for post-audit options (if issues found)"
- Post-Audit Actions: Added <IMPORTANT> block with explicit counter-rationalizations before AskUserQuestion example
- Step 3 (Report Findings): Added forward reference "After reporting, you MUST use AskUserQuestion to offer fix options"

**Why:** Agents were completing audits but displaying options as prose text instead of invoking AskUserQuestion tool as instructed. They rationalized skipping the tool ("user can just tell me what they want").

**Solution:** Layered redundancy approach:
1. Success criteria declares requirement explicitly
2. Forward reference in reporting step creates expectation
3. Counter-rationalizations block common bypass attempts ("DO NOT skip because 'user can just tell me'")

**Impact:** Increases compliance with explicit tool invocation instructions, prevents prose fallback pattern.

**Files modified:**
- `SKILL.md:253` - Added Success Criteria item 7
- `SKILL.md:261-268` - Added <IMPORTANT> counter-rationalization block
- `SKILL.md:152` - Added forward reference to Post-Audit Actions

## [2026-01-03] - Phase 27 Severity Change: WARNING → CRITICAL

### Changed

**Phase 27 (Relative Path Depth) severity escalated to CRITICAL:**
- Previous severity: WARNING (allowed skills to pass with warnings)
- New severity: CRITICAL (blocks PASSED status until fixed)
- Updated rationale: "Deep relative paths like `../../../../skills/managing-skills/references/foo.md` are fragile, break when files reorganize, and make skills unmaintainable. Skills with 3+ levels of `../` MUST convert to repo-root paths (`.claude/skills/...`) before achieving PASSED status."

**Why:** The creating-skills skill has multiple instances of `../../../../` paths. With WARNING severity, these issues allow skills to pass with warnings, accumulating technical debt. CRITICAL severity enforces immediate remediation.

**Impact:** Skills with 3+ levels of relative paths will now FAIL audit and must fix paths before achieving PASSED status.

**Files modified:**
- `references/phase-details.md:1100` - Changed severity from WARNING to CRITICAL
- `references/phase-details.md:1104` - Enhanced rationale with enforcement language

## [2026-01-03] - Add General Detection Principles to phase-details.md

### Added

**General Detection Principles section to references/phase-details.md:**
- Documents 5 core detection principles for instruction-based auditing
- Principle 1: Skip Teaching Content (isInWrongExample logic)
- Principle 2: Only Audit Code Blocks (isInCodeBlock logic)
- Principle 3: Check Context for ROOT Calculation (hasRootDetection logic)
- Principle 4: Severity Context Matters
- Principle 5: Template vs Real Content

**Rationale:** Moving from TypeScript-based auditing to instruction-based auditing requires explicitly documenting detection principles that were previously encoded in helper functions. These principles prevent false positives when auditing skills that contain teaching examples (WRONG/❌), command prose vs code blocks, and contextual severity determination.

**Location:** Inserted after Architecture Note (line 15) and before Phase 1: Description Format (line 90).

## [2026-01-03] - Complete Phase Number Decoupling from TypeScript Code

### BREAKING CHANGES ⚠️

**Fix IDs have changed from phase-numbered to semantic names:**

| Old Fix ID | New Fix ID |
|------------|------------|
| `phase1-description` | `description-format` |
| `phase3-linecount` | `linecount` |
| `phase4-broken-link-missing` | `broken-link-missing` |
| `phase9-scripts` | `bash-migration` |
| `phase10-phantom-reference-fuzzy` | `phantom-reference` |
| `phase11-command` | `command-portability` |
| `phase13-todowrite` | `todowrite-mandate` |
| `phase19-broken-gateway-path` | `broken-gateway-path` |

**Impact:** Any automation or scripts using old fix IDs must be updated.

### Core Principle Established

**Phase numbers now ONLY exist in `phase-registry.ts`.**

All other code uses semantic names. User-facing console output still shows phase numbers but these are acceptable as runtime information.

### Changed

**1. Registry Helper Functions Added (phase-registry.ts):**
- `getPhaseByName(semanticName)` - Find phase by semantic name
- `getPhaseDisplayName(phaseNumber)` - Get display name by number
- `getAllPhases()` - Get all phases from registry

**2. Console Reporter (reporters/console-reporter.ts):**
- Replaced hardcoded `PHASE_NAMES` mapping with registry-based generation

**3. Type/Interface Names (types.ts):**
- `Phase4AmbiguousCase` → `BrokenLinkAmbiguousCase`
- `Phase10AmbiguousCase` → `ReferenceAuditAmbiguousCase`
- `Phase19AmbiguousCase` → `PathResolutionAmbiguousCase`
- `Phase4HybridResult` → `BrokenLinkHybridResult`
- `Phase10HybridResult` → `ReferenceAuditHybridResult`
- `Phase19HybridResult` → `PathResolutionHybridResult`

**4. Fix IDs (fix-applier.ts, fix-suggest.ts):**
- All fix IDs changed from `phaseXX-*` to semantic names (see breaking changes)

**5. Pattern Keys (suggestion-patterns.ts):**
- `phase3-too-long` → `linecount-too-long`
- `phase3-approaching-limit` → `linecount-approaching-limit`
- `phase4-broken-links` → `broken-links`
- `phase5-file-organization` → `file-organization`
- `phase6-script-organization` → `script-organization`
- `phase7-output-directories` → `output-directories`
- `phase9-scripts` → `bash-migration`
- `phase10-deprecated-refs` → `deprecated-refs`
- `phase12-cli-error-handling` → `cli-error-handling`
- `phase13-todowrite` → `todowrite-mandate`

**6. Function Names (fix-suggest.ts):**
- `generatePhase1Suggestion` → `generateDescriptionSuggestion`
- `generatePhase3Suggestion` → `generateLineCountSuggestion`
- `generatePhase9Suggestion` → `generateBashMigrationSuggestion`
- `generatePhase11Suggestion` → `generateCommandAuditSuggestion`
- `generatePhase13Suggestion` → `generateTodoWriteSuggestion`

**7. Method Names (audit-engine.ts):**
- `fixPhase2` → `fixAllowedTools`
- `fixPhase4` → `fixBrokenLinks`
- `fixPhase5` → `fixOrganizeFiles`
- `fixPhase6` → `fixScriptOrganization`
- `fixPhase7` → `fixOutputDirectory`
- `fixPhase10` → `fixReferenceAudit`
- `fixPhase12` → `fixCliErrorHandling`
- `fixPhase14` → `fixTableFormatting`
- `fixPhase19` → `fixWindowsPaths`
- `fixPhase21` → `fixRoutingTableFormat`

**8. JSDoc Comments Cleaned (all phase files + lib files):**
- Removed "Phase X:" prefixes from all 27 phase file headers
- Removed "Run Phase X audit" from method documentation
- Removed phase numbers from inline comments across all lib files
- Kept semantic descriptions intact

**9. Internal Variables Renamed:**
- `phase1` → `descriptionFormatResult` (etc. for all phases)
- Interface properties in `FullMetrics` (progress.ts)
- All `phaseXSuggestion` variables → semantic names

### Files Modified

- `src/lib/phase-registry.ts` - Added helper functions
- `src/lib/reporters/console-reporter.ts` - Registry-based phase names
- `src/lib/types.ts` - Interface renames
- `src/lib/fix-applier.ts` - Semantic fix IDs
- `src/lib/fix-suggest.ts` - Semantic fix IDs, function names, method calls
- `src/lib/suggestion-patterns.ts` - Semantic pattern keys
- `src/lib/audit-engine.ts` - Method names, JSDoc, variable names
- `src/lib/progress.ts` - Variable names, interface properties, comments
- `src/lib/orchestrator.ts` - Method calls
- `src/lib/agent-analyzer.ts` - Comment cleanup
- `src/lib/phases/*.ts` - 27 phase files, JSDoc headers cleaned
- `src/lib/index.ts` - Updated exports

### Benefits

1. **Single Source of Truth:** Phase numbers centralized in phase-registry.ts
2. **Maintainability:** Renumbering phases only requires updating the registry
3. **No More Stale References:** Code can't get out of sync with phase numbers
4. **Semantic Clarity:** Variable/method/function names describe what they do
5. **Type Safety:** All TypeScript types verified and correct

---

## [2026-01-03] - Consolidate Phase Documentation from managing-skills

### Changed
- **phase-details.md enriched**: Migrated unique content from 14 orphaned phase files in managing-skills/references/
- **Ownership model enforced**: auditing-skills owns ALL phase documentation (phase-details.md is source of truth)
- **Content preserved**: No loss of valuable examples, edge cases, procedures, or reference tables

### Fixed
- **console-reporter.ts phase mapping**: Corrected Windows Paths from phase 16 → phase 19
- **Phase numbering hygiene**: All phases now correctly mapped (Phase 14-27)

### Content Migrations

**Phase 1 (Description Format)**:
- Added name validation rules (lowercase, 64 char max, no consecutive hyphens)
- Added historical impact data (116 of 147 skills had broken descriptions)
- Added edge cases for multi-domain, migration, and error-driven skills

**Phase 2 (Allowed Tools)**:
- Added valid tools list (Read, Write, Edit, MultiEdit, Bash, Grep, Glob, etc.)
- Added tool selection guidelines table by skill purpose

**Phase 3 (Line Count)**:
- Added extensive skill type classification (reasoning/tool-wrapper/hybrid)
- Added detection heuristics table with patterns
- Added severity matrix with word count thresholds by skill type

**Phase 4 (Broken Links)**:
- Added auto-fix strategies (path correction, stub creation, case correction, fuzzy matching)
- Added "Why It Matters" section with impact on Claude and users

**Phase 7 (Output Directory)**:
- Added TDD artifacts detection patterns (filename + content patterns)
- Added distinction between actual test results vs teaching docs (tdd-methodology.md is OK)
- Added standard .gitignore template

**Phase 8 (TypeScript Structure)**:
- Added test scoping behavior (single-skill vs all-skills audit modes)
- Added before/after v1.1.0 comparison showing false negative fix

**Phase 9 (Bash Migration)**:
- Upgraded severity from INFO → WARNING (cross-platform is critical)
- Added shell script complexity analysis (simple/moderate/complex)
- Added migration priority matrix by language

**Phase 10 (Reference Audit)**:
- Added deprecation registry schema and location
- Added registry structure examples (skills, agents, commands)

**Phase 11 (Command Audit)**:
- Added ROOT pattern explanation (why --show-superproject-working-tree works)
- Added detailed reasoning: super-repo vs submodule detection

**Phase 12 (CLI Error Handling)**:
- Added exit code decision tree (visual flowchart)
- Added testing exit codes section with bash examples

**Phase 19 (Windows Paths)**:
- Added pattern detection regex
- Added edge cases (escape sequences, regex patterns, Windows-specific docs)
- Enriched with examples from phase-16-windows-paths.md (was incorrectly numbered)

### Files to be Deleted (in separate managing-skills update)

The following orphaned files in managing-skills/references/ are now obsolete (content migrated):
- phase-01-description.md
- phase-02-allowed-tools.md
- phase-03-word-count.md
- phase-04-broken-links.md
- phase-05-file-organization.md
- phase-06-script-organization.md
- phase-07-output-directories.md
- phase-08-typescript-structure.md
- phase-09-bash-migration.md
- phase-10-reference-audit.md
- phase-11-command-examples.md
- phase-12-cli-errors.md
- phase-13-state-externalization.md
- phase-16-windows-paths.md (should have been phase-19)

## [2026-01-03] - Add Phase 27: Relative Path Depth Detection

### Added
- **Phase 27 (Relative Path Depth)**: New hybrid phase detecting deep relative paths in markdown links
  - Flags links with 3+ levels of `../` (e.g., `../../../../skills/...`)
  - Calculates repo-root equivalent paths
  - Suggests conversion to robust `.claude/...` format
  - Auto-fix capability: Yes (Hybrid - TypeScript calculates, Claude verifies)

### Problem Solved
**Fragile Relative Paths in Skills**
- Skills using `../../../../skills/managing-skills/references/foo.md` are hard to read and break when files move
- Found 23+ instances across skill-management subskills (creating-skills, updating-skills, etc.)
- Pattern fragility compounds with deep directory structures

### Distinction from Phase 4
- **Phase 4 (Broken Links)**: Does target file exist? (working vs broken)
- **Phase 27 (Path Depth)**: Is path pattern robust? (maintainable vs fragile)
- A link can pass Phase 4 but fail Phase 27

### Detection Logic
1. Extract all markdown links from SKILL.md
2. Skip external URLs (http://, https://)
3. Count `../` segments in path
4. Flag if ≥3 levels
5. Calculate repo-root equivalent path by resolving from skill directory

### Correct Pattern
```markdown
# ❌ WRONG: Deep relative path (fragile)
[Repository Root Navigation](../../../../skills/managing-skills/references/patterns/repo-root-detection.md)

# ✅ CORRECT: Repo-root path (robust)
[Repository Root Navigation](.claude/skills/managing-skills/references/patterns/repo-root-detection.md)
```

### Files Created/Updated
1. **NEW**: `scripts/src/lib/phases/relative-path-depth.ts` - Phase 27 implementation
2. `scripts/src/lib/phase-registry.ts` - Registered Phase 27 as Hybrid
3. `references/phase-details.md` - Added Phase 27 documentation
4. `SKILL.md` - Updated phase count (26→27), categorization (Hybrid: 3→4)
5. `references/common-failure-patterns.md` - Updated todo counts (29→30 steps)

### Categorization
- **Fix Type**: Hybrid (4 phases: 4, 10, 22, 27)
- **Severity**: WARNING
- **Auto-fixable**: Yes

## [2026-01-03] - Expand Phase 11 to Detect All Write Commands with .claude/ Paths

### Changed
- **Phase 11 (Command Audit)**: Expanded detection from `cd` only to all write/create operations
  - Before: Only detected `cd .claude/skills/...` without ROOT
  - After: Detects `mkdir`, `cp`, `mv`, `touch`, `echo ... >` commands with `.claude/` paths without ROOT
  - Also expanded `cd` detection from `.claude/skills/` to any `.claude/` path

### Problem Solved
**Real Bug: Nested .claude/.claude/ Directory Creation**
- Research skills using `mkdir -p .claude/research/${TIMESTAMP}` created `.claude/.claude/research/` when executed from `.claude/` directory
- Skills assumed they were running from repo root, but agents could be in any directory
- Pattern affected any write operation to `.claude/` paths without absolute path calculation

### Evidence
Found `.claude/.claude/research/` directories created by research orchestration skills.

### Technical Details
**New Detection Rules:**
1. `mkdir`, `cp`, `mv`, `touch` commands with `.claude/` paths → WARNING if no ROOT
2. `echo ... > .claude/...` redirections → WARNING if no ROOT
3. `cd .claude/...` (expanded from just `cd .claude/skills/...`) → WARNING if no ROOT
4. Read-only commands (`ls`, `cat`, `grep`) → Not flagged (optional INFO in future)

**Detection Logic:**
- Scan bash/sh code blocks
- Check if write command targets `.claude/` path
- Verify ROOT calculation precedes the command in same or previous line
- Skip commands in "WRONG" example contexts (❌, WRONG markers)

**Correct Pattern:**
```bash
ROOT="$(git rev-parse --show-superproject-working-tree --show-toplevel | head -1)"
mkdir -p "$ROOT/.claude/research/${TIMESTAMP}"
```

### Files Updated
1. `references/phase-details.md` - Expanded Phase 11 documentation with examples
2. `scripts/src/lib/phases/command-audit.ts` - Added Rules 4 and 4b for write commands
3. `.claude/skills/managing-skills/references/patterns/phase-categorization.md` - Updated section title and scope
4. `scripts/src/lib/phases/__tests__/command-audit-expansion.test.ts` - Added 9 test cases (all passing)

### Test Coverage
- ✅ mkdir without ROOT flagged
- ✅ cp without ROOT flagged
- ✅ mv without ROOT flagged
- ✅ touch without ROOT flagged
- ✅ echo redirection without ROOT flagged
- ✅ cd to any .claude/ path without ROOT flagged
- ✅ Commands with ROOT not flagged
- ✅ Commands in WRONG contexts not flagged
- ✅ Multiple violations detected in single skill

## [2026-01-03] - Fix Phase 15: Apply Two-Layer Architecture Pattern

### Changed
- **Phase 15 (Code Block Quality)**: Refactored from validation-only to Claude-Automated with two-layer architecture
  - Before: TypeScript used regex to suggest language tags, marked as autoFixable, made semantic judgments
  - After: TypeScript flags CANDIDATES (INFO severity), Claude performs semantic classification
  - Pattern: Identical to Phase 26 (Reference Content Quality) two-layer architecture

### Problem Solved
**False Positives (Regex Cannot Understand Context):**
- Bad practice examples (code blocks after "❌ WRONG:") → Incorrectly flagged as missing tags
- Template code (*-template.md files with TODO comments) → Incorrectly suggested language tags
- Console output (command results, logs) → Incorrectly flagged as needing tags
- Pseudo-code (algorithm steps) → Incorrectly matched against language patterns
- Meta-discussion (discussing code block syntax) → Incorrectly flagged

**Architectural Flaw:**
- TypeScript made semantic judgments about context
- autoFixable: true on candidates that needed human/Claude review
- Same flaw that was fixed in Phase 26

### Technical Details
**Layer 1 - TypeScript (Mechanical):**
- Flag missing language tags → INFO severity (not WARNING)
- Flag potential mismatches → INFO severity
- Provide context (file name, pattern detection) for Claude
- Remove autoFixable suggestions based on regex
- Add template file detection (file name contains "-template" or "-example")

**Layer 2 - Claude (Semantic):**
- Classify each candidate using [phase-15-semantic-review.md](references/phase-15-semantic-review.md)
- 8 classification categories:
  1. Genuine missing tag (FLAG)
  2. Genuine mismatch (FLAG)
  3. Output/console (IGNORE)
  4. Pseudo-code (IGNORE)
  5. Bad practice example (IGNORE)
  6. Template placeholder (IGNORE)
  7. Multi-language/mixed (IGNORE)
  8. Meta-discussion (IGNORE)

**Context Clues for Classification:**
- File name (*-template.md, *-example.md)
- Markers ("WRONG:", "❌", "Output:", "Result:")
- Surrounding text explaining purpose
- TODO comments in template context

### Files Modified
- `scripts/src/lib/phases/code-block-quality.ts` - Two-layer architecture implementation
- `references/phase-15-semantic-review.md` - NEW: Classification guide for Claude
- `references/phase-details.md` - Updated Phase 15 section with new architecture
- `.claude/skills/managing-skills/references/patterns/phase-categorization.md` - Moved Phase 15 from Validation-Only to Claude-Automated
- `SKILL.md` - Updated phase counts (9 Claude-Automated, 2 Validation-Only)

### Category Change
- **Before**: Validation-Only (reported issues, no fix)
- **After**: Claude-Automated (semantic reasoning without human input)

---

## [2026-01-03] - Refactor Phase 13: Replace Heuristics with Semantic Reasoning

### Changed
- **Phase 13 (State Externalization)**: Refactored from heuristic complexity detection to metrics collection + Claude semantic reasoning
  - Before: Heuristics (section count + keywords + word count) determined if skill was "complex"
  - After: TypeScript collects objective metrics, Claude performs semantic classification
  - Result: Bidirectional validation (catches both under-mandated AND over-mandated skills)

### Problem Solved
**False Negatives:**
- Dense 3-section algorithm skills without "workflow" keywords → marked simple, missed need for TodoWrite
- Multi-phase coordination skills with <1500 words → not flagged

**False Positives:**
- 6-section reference guides with "step-by-step" examples → flagged as complex, unnecessary TodoWrite added
- Long documentation skills → flagged complex despite being pure reference lookups

**Accumulated Debt:**
- Skills have unnecessary TodoWrite mandates (added to pass heuristic audit)
- Skills missing TodoWrite when semantic analysis shows they need it

### Technical Details
**TypeScript Metrics Collection (Deterministic):**
- Section count: Count `## ` headers
- Word count: Split on whitespace
- Workflow keywords: Detect presence of "systematic|protocol|workflow|phase|checklist|step-by-step"
- Numbered steps: Detect "Step 1:" or "Phase 2:" patterns
- Tool sequences: Count tool mentions (Read|Write|Edit|Bash|Grep|Glob|Task) ≥3
- Mandate strength: Detect STRONG/WEAK/MISSING via regex patterns (unchanged)

**Claude Semantic Reasoning:**
- Classify skill type: Multi-step workflow vs. reference docs vs. gateway router vs. atomic action vs. conceptual guide
- Determine if agent would lose state during execution
- Apply bidirectional validation matrix:
  - Missing mandate + needs state tracking → CRITICAL (add mandate)
  - Strong mandate + reference docs → WARNING (remove overhead)
  - Weak mandate + needs state tracking → WARNING (strengthen)
  - All other combinations → PASS or INFO

**Removed Heuristic Logic:**
- `detectComplexity()` method with `isComplex` boolean determination
- `criteriaCount >= 2` rule for complexity threshold
- Automatic CRITICAL/WARNING based on heuristics

### Files Modified
- `scripts/src/lib/phases/state-externalization.ts` (231 lines → ~180 lines)
  - Replaced `ComplexityScore` interface with `SkillMetrics` interface
  - Replaced `detectComplexity()` with `collectMetrics()` (no judgments)
  - Updated `validate()` to return INFO with metrics context (not CRITICAL/WARNING)
  - Removed heuristic complexity determination logic
  - Added extensive header comments explaining semantic reasoning approach
- `.claude/skills/managing-skills/references/patterns/phase-categorization.md`
  - Updated Claude-Automated table: "TodoWrite missing" → "State externalization"
  - Updated description: "Distinguish stateful workflows from reference docs"
  - Updated Quick Reference: "state externalization (TodoWrite)"

### Files Created
- `references/phase-13-semantic-review.md` (~400 lines)
  - Complete bidirectional validation matrix with 6 combinations
  - Semantic criteria for "Needs TodoWrite" (6 indicators)
  - Semantic criteria for "Does NOT Need TodoWrite" (6 indicators)
  - 8 worked examples (4 needs TodoWrite, 4 doesn't need it)
  - Reasoning template for skill classification
  - Batch review recommendations for accumulated debt cleanup

### Verification
- `using-tanstack-query` (reference docs) → Should NOT be flagged for missing mandate
- `orchestrating-fingerprintx-development` (8-phase workflow) → SHOULD require strong mandate
- Skills with unnecessary mandates → Flagged as INFO for overhead review

### Related Changes
- Phase categorization updated to reflect Phase 13 as Claude-Automated
- Documentation links added to explain semantic reasoning process

## [2026-01-02] - Refactor Phase 26: Eliminate False Positives via Hybrid Detection

### Changed
- **Phase 26 (Reference Content Quality)**: Refactored from pure regex to hybrid TypeScript + Claude reasoning
  - Before: Regex patterns flagged ALL TODO/placeholder text (including intentional templates and examples)
  - After: TypeScript detects candidates (empty/small files), Claude classifies semantic intent
  - Result: False positives eliminated while preserving genuine stub detection

### Technical Details
**TypeScript Detection (Deterministic):**
- Empty files (size === 0) → CRITICAL severity
- Small files (size < 100 bytes) → INFO severity (candidate for review)

**Claude Reasoning (Semantic):**
- Genuine stub (flag) - Incomplete work needing content
- Template code (ignore) - Intentional placeholder for users to copy
- Bad practice example (ignore) - Shows what NOT to do in code blocks
- Redirect file (ignore) - Points elsewhere, complete in purpose
- Intentionally minimal (ignore) - Brief but complete
- Conceptual discussion (ignore) - Discusses TODOs as the subject matter

**Removed Detection (False Positive Prone):**
- `^#+ TODO` header check (lines 44-51) - Flagged template headers
- `TODO: add|implement|document|complete` check (lines 54-61) - Flagged template code
- `placeholder|coming soon|to be added` check (lines 64-71) - Flagged descriptions of templates

### Files Modified
- `scripts/src/lib/phases/phase26-reference-content-quality.ts`
  - Removed 3 regex-based checks (lines 44-71)
  - Simplified getStatistics() to track only empty/minimal files
  - Kept deterministic checks: empty files (CRITICAL), small files (INFO)
- `scripts/src/lib/phase-registry.ts`
  - Added comment explaining hybrid nature: "TypeScript detects, Claude reasons"
- `.claude/skills/managing-skills/references/patterns/phase-categorization.md`
  - Added Phase 26 to Claude-Automated table with description
  - Added "Reference Content Quality (Claude-Automated)" section with process details
  - Updated Quick Reference with "Reference content quality (empty/stub file detection)"

### Files Created
- `references/phase-26-semantic-review.md` (~150 lines)
  - Complete classification guide with 6 categories and examples
  - Context clues for distinguishing genuine stubs from false positives
  - Reasoning process for semantic classification
  - Real examples from false positive cases

### Verification
**False Positives Eliminated:**
- ✅ `npm run audit -- using-todowrite` - No Phase 26 warnings
- ✅ `npm run audit -- integration-step-validator` - No Phase 26 warnings

**True Positives Preserved:**
- ✅ `npm run audit -- securing-react-implementations` - 15 empty files correctly flagged

### Why This Matters
**Problem:** Regex cannot understand semantic context:
1. `integration-templates.md` has `// TODO: Implement actual API call` → INTENTIONAL template code
2. `integration-templates.md` has `placeholder showing the pattern` → DESCRIBES the template
3. `template-guidance.md` has `[TODO: Add pattern here]` → EXAMPLE of bad practice

**Solution:** Semantic reasoning tasks require Claude, not pattern matching.

### Phase Categorization
- **Hybrid (TypeScript + Claude)**: Phase 26 combines deterministic detection with semantic reasoning
- TypeScript: Flags candidates (empty/small files) deterministically
- Claude: Classifies candidates semantically without human input
- Category: Claude-Automated (no user interaction needed)

### Method
- Updated via updating-skills workflow (RED-GREEN-REFACTOR)
- Backup created: `.local/phase26-reference-content-quality.ts.backup`

---

## [2026-01-02] - Add Phase 23: Reference Content Quality

### Added
- **Phase 23: Reference Content Quality**: New validation phase to detect placeholder/stub content in reference files
  - Detects empty files (0 bytes) - CRITICAL severity
  - Detects TODO stub headers (`# TODO`, `## TODO`) - WARNING severity
  - Detects TODO stub verbs (`TODO: add`, `TODO: implement`) - WARNING severity
  - Detects placeholder text (`placeholder`, `coming soon`, `TBD:`) - WARNING severity
  - Detects minimal content (<100 bytes) - INFO severity
  - Enhancement TODOs at end of complete files are NOT flagged

### Files Created
- `scripts/src/lib/phases/phase23-reference-content-quality.ts`: Phase implementation
  - Follows pattern from Phase 15 (Orphan Detection)
  - Includes validate(), run(), runOnParsedSkills(), and getStatistics() methods
  - Comprehensive issue detection with appropriate severities

### Files Modified
- `scripts/src/lib/phase-registry.ts`: Registered Phase23ReferenceContentQuality
  - Added import statement for Phase 23
  - Added phase definition to PHASE_REGISTRY array
  - Updated comment: "Advanced validation (21-22)" → "Advanced validation (21-23)"
- `references/phase-details.md`: Added Phase 23 documentation
  - Complete explanation of checks and severities
  - Example failures and why they matter
  - Clarification that enhancement TODOs are acceptable
- `SKILL.md`: Already reflected "23-phase audit" in description (line 3)

### Why This Matters
- Skills were passing all 22 existing phases while having 15+ empty reference files
- Evidence: 24 empty files, 25+ TODO stubs, 45 affected skills in .claude/skill-library
- Phase 7 checks if references/ directory EXISTS but not content QUALITY
- Empty files = CRITICAL because skill is fundamentally incomplete
- TODO stubs = WARNING because skill functions but documentation is missing

### Phase Categorization
- **Validation-Only**: Phase 23 detects issues but requires human judgment to fix (populate with real content)
- No auto-fix capability - fixing-skills can be updated separately for remediation workflow

### Phase Count Update
- Total phases: 22 → 23 distinct phase numbers
- Phase 14 still has 4 sub-phases (14a, 14b, 14c, 14d)
- PHASE_COUNT calculation automatically reflects new total via Math.max()

---

## [2025-12-31] - Fix Semantic Review JSON Confusion

### Changed
- **Semantic Review Checklist**: Removed "(CSO)" suffix from "Description Quality (CSO)" criterion name
  - Before: "Description Quality (CSO)" in checklist
  - After: "Description Quality" (matches schema validation)
  - Reason: The "(CSO)" caused Claude to use wrong criterion name in JSON, failing schema validation

### Added
- **Inline JSON Example**: Added explicit example showing correct semantic findings structure
  - Shows exact field names: `severity`, `criterion`, `issue`, `recommendation`
  - Includes warning: "Required fields: ... (NOT 'phase'!)"
  - Prevents confusion between structural phase output and semantic criterion field

### Why This Matters
- Claude was copying "Description Quality (CSO)" from checklist into JSON
- Schema validation rejected it (only accepts "Description Quality")
- Adding inline example prevents need to navigate to reference file
- Explicit "NOT 'phase'!" warning prevents wrong field name

### Files Changed
- `SKILL.md` line 174: Removed "(CSO)" from criterion name
- `SKILL.md` lines 208-225: Added inline JSON example with explicit field requirements

---

## [2025-12-31] - Simplify Repository Root Navigation Pattern

### Changed
- **Repository Root Detection**: Replaced complex 3-line pattern with simplified industry-standard approach
  - Before: Three separate commands with stderr redirect and conditional test
  - After: Single combined git command with pipe to `head -1`
  - Variable rename: `REPO_ROOT` → `ROOT` for consistency with command files and MCP tools

### Technical Details
**Old Pattern (Lines 66-68, 89-91):**
```bash
REPO_ROOT=$(git rev-parse --show-superproject-working-tree 2>/dev/null)
test -z "$REPO_ROOT" && REPO_ROOT=$(git rev-parse --show-toplevel)
cd "$REPO_ROOT"
```

**New Pattern:**
```bash
ROOT="$(git rev-parse --show-superproject-working-tree --show-toplevel | head -1)" && cd "$ROOT"
```

**Why This Is Better:**
- Single git command with both flags (--show-superproject-working-tree and --show-toplevel)
- The `| head -1` picks first non-empty result automatically (super-repo root when in submodule, repo root otherwise)
- No stderr redirect (`2>/dev/null`) needed
- No conditional `test -z` check needed
- Simpler: 2 commands instead of 3
- Avoids bash parsing errors when combined with other operators (`;`, `&&`, `|`)
- Proven to work from both super-repo and submodules

### Files Changed
- `SKILL.md` lines 66-68: Updated "Step 0: Navigate to Repository Root"
- `SKILL.md` lines 89-91: Updated "Audit Single Skill" setup section
- `SKILL.md` line 94: Updated compatibility note to explain new pattern behavior
- `SKILL.md` line 311: Changed "Missing REPO_ROOT pattern" to "Missing repository root pattern"
- `references/common-failure-patterns.md` lines 107-120: Updated "Missing cd REPO_ROOT pattern" section with new approach

### Reason
- **Problem**: Complex 3-line pattern caused bash parsing errors and was difficult to maintain
- **Solution**: Industry-standard git pattern used across command files and MCP tools
- **Impact**: More reliable, easier to understand, consistent with project conventions

### Testing
- ✅ Pattern tested from submodule directory (modules/chariot/ui/src/)
- ✅ Pattern tested from super-repo root
- ✅ No bash parsing errors

### Method
- Updated via Edit tool following TDD workflow (RED-GREEN-REFACTOR)
- Backup created: `.local/SKILL.md.backup-20251231-*`

---

## [2025-12-30] - Add Phase 14d: Prose Phase References

### Added
- **Phase 14d: Prose Phase References** - Detects stale prose phase references after phase renumbering
- Implementation: `scripts/src/lib/phases/phase14d-prose-phase-references.ts` (~300 lines)
- Detailed reference: `references/phase-details.md` - Added Phase 14d section
- Registry update: Added to `phase-registry.ts` as validation-only phase

### Changed
- Phase count: 22 phases → 23 phases (22 + 4 sub-phases → 22 + 5 sub-phases)
- SKILL.md description: "22-phase audit" → "23-phase audit"
- Quick Reference table: "Full 22-phase audit" → "Full 23-phase audit"
- Validation-Only category: 14b-c → 14b-d
- Updated fixing-skills SKILL.md: Phases 14b-c → 14b-d in all references

### Reason
- **RED failure**: Audit doesn't detect stale prose references like "Phase 4 (implementation)" after phase renumbering
- **Real example**: orchestrating-feature-development has 5 stale references after Phase 2 (Discovery) insertion
- Phase 4 (Broken Links) only catches markdown link syntax `[Phase 3](phase-3-file.md)`
- Prose references like "Return to Phase 4 (implementation)" remain undetected

### Technical Details
**Detection Logic:**
1. Extracts canonical phase list from SKILL.md Quick Reference table or `## Phase N:` headings
2. Scans all skill files (SKILL.md + references/*) for prose patterns: `Phase N (name)` or `Phase N:`
3. Validates phase number exists and name hint matches canonical phase name
4. Excludes: `.history/CHANGELOG` (historical), code blocks, cross-skill references

**Output Format:**
```
Phase 14d: Prose Phase References
  WARNING: 5 stale phase reference(s) found

  troubleshooting.md:108 - 'Phase 4 (implementation)' - Phase 4 is now 'Architecture', implementation is Phase 5
  troubleshooting.md:286 - 'Phase 3 (architecture)' - Phase 3 is now 'Planning', architecture is Phase 4
```

**Severity:** WARNING (doesn't break functionality)
**Fix support:** Validation-Only - requires semantic understanding to fix correctly

### Files Changed
- `scripts/src/lib/phases/phase14d-prose-phase-references.ts` - NEW: Phase implementation
- `scripts/src/lib/phase-registry.ts` - Added Phase 14d import and registration
- `SKILL.md` - Updated phase count (22→23), updated Validation-Only phases (14b-c→14b-d)
- `references/phase-details.md` - Added Phase 14d section with examples
- `../fixing-skills/SKILL.md` - Updated Validation-Only category (14b-c→14b-d) in 3 locations

### Impact
**Success criteria:** Running audit on orchestrating-feature-development now detects 5 stale prose references that were previously missed.

## [2025-12-30] - Add Phase Numbering Hygiene Criterion

### Added
- **Criterion 7: Phase Numbering Hygiene** - New semantic review criterion that detects fractional major phase numbers
- Detailed reference file: `references/phase-numbering-hygiene.md` (~200 lines)
- Detection pattern: Scans for `## Phase X.Y` or `## Step X.Y` in headings
- Distinguishes major phases (flag WARNING) from acceptable sub-steps (e.g., `### Step 7.1`)

### Changed
- Semantic Review Checklist: 6 criteria → 7 criteria
- Added "Phase Numbering Hygiene Assessment" subsection in SKILL.md
- Updated `references/semantic-review-output.md`: "6 criteria" → "7 criteria"
- Line count: 308 → 322 lines (still well under 500 limit)

### Reason
- **RED failure**: No audit criterion detects fractional phase numbering (Phase 3.5, Phase 5.4)
- Historical evidence: `creating-skills` CHANGELOG references Phase 5.3, 5.4, 2.3
- `managing-skills/references/patterns/changelog-format.md` line 7 references Phase 5.4
- `updating-skills` was just updated to mandate sequential integer numbering
- Fractional phases create maintenance debt and numbering confusion

### Technical Details
**Detection Logic:**
1. Scans SKILL.md and all files under `references/` directory
2. Regex pattern: `^##+ (Phase|Step) \d+\.\d+` in headings
3. Distinguishes fractional MAJOR phases (bad) from sub-steps (acceptable)
4. Sub-steps like `### Step 7.1` under `## Step 7` represent decomposition, not insertion

**Output Format:**
```json
{
  "severity": "WARNING",
  "criterion": "Phase Numbering Hygiene",
  "issue": "Fractional phase numbering detected: Phase 3.5 at line 45",
  "recommendation": "Renumber phases sequentially and update cross-references"
}
```

**Severity:** Always WARNING (not CRITICAL) - impacts maintainability but doesn't block functionality

### Files Changed
- `SKILL.md` - Added criterion 7 to checklist, added Phase Numbering Hygiene Assessment subsection
- `references/semantic-review-output.md` - Updated "6 criteria" to "7 criteria"
- `references/phase-numbering-hygiene.md` - NEW: Detection logic, examples, output format

### Impact
- Claude will now flag fractional phase numbers during semantic review
- Complements `updating-skills` Phase Numbering Rule
- Prevents accumulation of fractional phases in future skill updates
- Coordinated with pending `fixing-skills` update for automated remediation

### Related Updates
- Part of 4-skill update sequence:
  1. ✅ `updating-skills` - Added Phase Numbering Rule
  2. ✅ `auditing-skills` - Added detection criterion (this update)
  3. ⏳ `fixing-skills` - Add fix guidance
  4. ⏳ `managing-skills` - Fix stale Phase 5.4 reference

### Method
- Manual edit via Edit and Write tools
- Backup created: `.local/2025-12-30-*-auditing-skills-pre-phase-numbering-hygiene.bak`

---

## [2025-12-28] - Mandatory Description Quality Assessment

### Changed
- **INSTRUCTION-BASED ENFORCEMENT**: Added explicit, mandatory Description Quality Assessment instructions to semantic review
  - Before: Vague checklist item "Description Quality (CSO)" with no concrete criteria
  - After: Dedicated subsection with 5-criteria evaluation framework (Accuracy, Completeness, Specificity, Discoverability, Honesty)
  - Impact: Transforms description quality from "easy to skip" to "impossible to bypass"

### Technical Details
- Updated "Semantic Review Checklist" to mark Description Quality as "MANDATORY detailed assessment (see section below)"
- Added new subsection "Description Quality Assessment (MANDATORY)" with brief summary + link
- Full 5-criteria framework extracted to `references/description-quality-assessment.md`:
  - 5-criteria evaluation table with specific questions and failure examples
  - Step-by-step assessment instructions
  - JSON output format for findings
  - Concrete examples of issues to report (4 examples)
  - Severity guidance table
- Added enforcement statement before "END OF TASK": "⚠️ AUDIT IS INCOMPLETE if you skip Description Quality Assessment"

### Why This Matters
The deleted `phase1b-description-quality.ts` was "fantasy code" that expected Claude to magically populate quality issues during TypeScript execution. Real enforcement requires explicit instructions that Claude must follow during semantic review.

**Description quality = skill discoverability.** A skill with poor description is an invisible skill.

### Files Modified
- `SKILL.md` - Reduced from 2286 to 1438 words via progressive disclosure
- `references/description-quality-assessment.md` - NEW: Full 5-criteria framework (~70 lines)
- `references/semantic-review-output.md` - NEW: JSON format, severity levels, output contract (~75 lines)

### Extractions Applied
1. **Description Quality Assessment** - Full framework extracted, inline summary retained
2. **Semantic Review Output** - JSON examples, severity levels, output contract extracted
3. **Fix Workflow** - Detailed procedures removed, link to fixing-skills retained
4. **Fixing Issues subsection** - Shortened to link only
5. **Post-Audit Semantic Review** - Duplicate section removed

### Testing
- ✅ Word count: 1438 (under 1500 limit)
- ✅ Line count: 307 (under 500 limit)
- ✅ All existing semantic review structure preserved
- ✅ Reference files integrate with existing JSON output format

### User-Facing Changes
When performing semantic review, Claude will now:
1. Evaluate descriptions against 5 concrete criteria
2. Report specific issues with recommendations

## [2026-01-02] Path Standardization

### Changed
- Converted all cross-skill references to repo-root format (.claude/...)
- Updated SKILL.md: 7 path references converted
- Updated phase-details.md: 4 path references converted
- Updated common-failure-patterns.md: 2 path references converted, removed deleted phase-01-description.md reference
- Updated phase-numbering-hygiene.md: 1 path reference converted
- Updated library-skill-patterns.md: Removed reference to deleted audit-phases.md

### Removed
- Reference to deleted managing-skills/references/audit-phases.md

### Fixed
- No Phase 14a/14b/14c/14d references found (previously cleaned up)
- All relative paths (../../../) replaced with repo-root format

## [2026-01-03] - Migrate to Instruction-Based Auditing (Delete TypeScript Infrastructure)

### BREAKING CHANGES ⚠️

**TypeScript CLI completely removed:**
- Deleted `scripts/` directory (package.json, tsconfig.json, src/, node_modules/, all TypeScript)
- No more `npm run audit` commands
- No more CLI-based automation

**New approach: Claude reads and applies rules directly**

### Changed

**SKILL.md completely rewritten (~342 lines, was 357):**
- Changed from documenting CLI usage to documenting HOW to audit
- Removed all npm commands, CLI references, script invocations
- Added instruction-based workflow:
  - Step 1: Read the skill file
  - Step 2: Apply rules from phase-details.md
  - Step 3: Report findings
  - Step 4: Reference fix procedures
- Changed allowed-tools: `Bash, Read, Grep, TodoWrite, AskUserQuestion` → `Read, Grep, TodoWrite`
- Updated description to clarify instruction-based approach

**Why This Change:**
- No CI/CD requirements justify TypeScript infrastructure maintenance overhead
- Claude can read phase-details.md and apply rules directly without compilation/build steps
- Simpler architecture: markdown documentation → Claude reasoning → findings report
- Eliminates dependency installation, TypeScript compilation, test suites
- Reduces token overhead (no need to load TypeScript source in context)

### Preserved

**All validation rules intact:**
- references/phase-details.md - Complete 27-phase rulebook (source of truth)
- references/phase-*-semantic-review.md - Semantic classification guides
- references/common-failure-patterns.md - Quick fix patterns
- references/library-skill-patterns.md - Specialized patterns
- references/phase-numbering-hygiene.md - Numbering rules
- references/description-quality-assessment.md - Quality framework
- references/semantic-review-output.md - Output format specs

**Supporting directories:**
- .history/ - Changelog preserved
- .local/ - Backups preserved
- references/ - All documentation preserved

### Removed

**Complete TypeScript infrastructure:**
- scripts/package.json - npm project configuration
- scripts/tsconfig.json - TypeScript compiler config
- scripts/src/ - All TypeScript source code (audit-engine, phases, reporters, etc.)
- scripts/node_modules/ - All npm dependencies
- scripts/.claude/ - Build artifacts

**Total deletion:** ~15,000 lines of TypeScript code, ~50MB of dependencies

### Migration Path

**Before (CLI-based):**
```bash
cd .claude
npm run audit -- creating-skills
```

**After (Instruction-based):**
```
User: Audit the creating-skills skill
Claude: [Reads SKILL.md, applies phase-details.md rules, reports findings]
```

### Success Criteria

1. ✅ SKILL.md is instruction-based (<350 lines, no npm/CLI refs)
2. ✅ scripts/ directory deleted
3. ✅ references/ preserved (all .md files intact)
4. ✅ Skill can be invoked: "Audit the creating-skills skill"
5. ✅ Claude reads phase-details.md and applies rules directly
6. ✅ All 27 validation phases documented and accessible

### Impact

**Positive:**
- Simpler architecture (markdown → reasoning → output)
- No build/compile steps needed
- Faster iteration (edit .md, immediate effect)
- Lower maintenance burden
- Reduced token overhead

**Trade-offs:**
- No automated batch auditing of all skills
- No deterministic auto-fixes (fixing-skills will need similar migration)
- Manual semantic review required for all audits

### Method

- Updated via updating-skills workflow (RED-GREEN-REFACTOR)
- Backup created: `.local/backups/SKILL-pre-instruction-migration-*.md`
- Changelog updated with complete migration details
