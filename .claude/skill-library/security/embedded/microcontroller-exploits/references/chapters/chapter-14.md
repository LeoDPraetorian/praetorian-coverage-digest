## []{#ch14.xhtml_page_137 .pagebreak}**14  MC13224, the Simplest Fault Injection** {#ch14.xhtml_ch14 .h2a}

Let's take a look at an exploit of mine from Goodspeed (2011), in which
the Freescale MC13224 is unlocked by grounding out one of its pins
during reset. This requires a custom PCB and a bit of hot air soldering,
but it's very reliable and does not involve any fancy software.

The MC13224 is a system-in-package (SiP) offering a 32-bit TDMI ARM7
CPU, with an 802.15.4 (Zigbee) radio. It has 128kB of SPI flash, 96kB of
RAM, and 80kB of ROM implementing the 15.4 MAC functions. This was the
chip used in the Defcon 18 Ninja Badge, Wozniak and Creighton (2010).
Its selling point is that a 50Ω trace antenna tuned for 2.4GHz is all
that you need to add as an antenna chain, with everything else but the
crystals included internally.

System-in-package is a great way to make the PCB designer's life easier,
but you can see from the decapsulated photos in [Figure
14.1](#ch14.xhtml_ch14fig1) that this package is really three little
chips in a trench-coat, trying to act like an
adult.^[1](#footnotes.xhtml_ch14fn1){#ch14.xhtml_ch14fn_1}^ The smallest
chip is a radio balun, the largest is a CPU combined with a radio, and
the third chip is flash memory.

Because the flash memory is on a separate die and the MC13224 has no
execute-in-place feature, it is unable to execute code from flash memory
directly. Rather, a ROM bootloader copies a working image from flash
memory into RAM. If the security word "[OKOK]{.literal}" is seen at the
beginning of the image, then JTAG access is enabled before the
bootloader branches into RAM. If the security word is instead set to
"[SECU]{.literal}," then JTAG access is not enabled and the chip remains
in its default, locked state.

::: image
[]{#ch14.xhtml_page_138
.pagebreak}![Image](images/f0138-01.jpg){#ch14fig1}

> **Description:** Photograph showing two decapsulated integrated circuit chips. The top image shows the intact chip package with die visible through resin, while the bottom image shows the PCB after more aggressive decapsulation. Both chips appear to be in DIP packages and were subjected to chemical or mechanical decapsulation to expose the silicon die. This technique is commonly used for reverse engineering, failure analysis, or security research to access the chip internals.

:::

Figure 14.1: Decapsulated MC13224

::: image
[]{#ch14.xhtml_page_139
.pagebreak}![Image](images/f0139-01.jpg){#ch14fig2}

> **Description:** Close-up photographs of two microcontroller chips. The top image shows a Microchip chip (marking visible showing manufacturer logo and date code 9114) with a ceramic window revealing the die inside. The bottom image shows another chip variant after decapsulation with the quartz window removed, exposing the bond wires and silicon die directly. Both are in DIP packages with pins visible on the sides. These images demonstrate UV-EPROM chips with erasure windows.

:::

Figure 14.2: SST25WF010

Looking closer at the flash chip, we find the model number from text
written on the die, shown in [Figure 14.3](#ch14.xhtml_ch14fig3). It's a
standard SST25WF010 low-voltage SPI flash chip. One way to read this
would be to decapsulate the target chip and then wire-bond this SPI
flash chip back into a new package and read it with a low-voltage SPI
adapter. That would certainly work, but we'd prefer a solution that
doesn't require expensive equipment like a wire bonder.

::: image
[]{#ch14.xhtml_page_140
.pagebreak}![Image](images/f0140-01.jpg){#ch14fig3}

> **Description:** Close-up die photo showing a ball grid array (BGA) chip viewed from above. The image reveals the regular grid pattern of bond pads arranged in rows and columns across the chip surface. Multiple parallel traces route signals from the die to the connection points. The intricate metal layer routing is visible with numerous interconnects fanning out from the central logic region. This view demonstrates the complexity of modern package-on-chip interconnection technology.

:::

Figure 14.3: MC13224, Pin 133 in Bold

[]{#ch14.xhtml_page_141 .pagebreak}A better technique takes advantage of
the fact that, while the SPI bus is not bound out to external pins, pin
133 ([NVM_REG]{.literal}) is the voltage regulator output for the flash
chip, which is exposed in order to allow an external voltage regulator
to replace the internal one. In low-power applications, power might be
saved by shutting this down after booting.

What happens when we cut power to the SST25WF010 flash memory by
grounding out this pin? Freescale (2010) explains in Figure 3-22 on
[page 93](#ch08.xhtml_page_93) that the MC13224 will enable JTAG access
when the magic word is not found in flash memory. It will then try to
boot from UART1 as a serial port, as a SPI slave, as a SPI master, or as
an I2C master. If none of these methods work, the chip will hang in an
infinite loop, but it hangs with JTAG enabled!

So all that is needed to recover a copy of an MC13224's flash memory is
a board that holds pin 133 low during a reset, then loads a new
executable into RAM that---after the pin is allowed to swing high---will
read firmware out of the recently powered SST25WF010 and exfiltrate it
through an I/O pin.

Toward that end, I've made a small batch of modified Econotag boards in
[Figure 14.4](#ch14.xhtml_ch14fig4) that expose this pin to a jumper. A
pair of tweezers can then hold the line low during a reboot to unlock
JTAG. Once the tweezers are removed, a client for the internal SST25 SPI
flash chip can be used through the board's built-in OpenOCD
implementation to dump the firmware.

For more sophisticated attacks on dual-die microcontrollers, see the
GD32F130 exploit in [Chapter D.2](#app04.xhtml_app04_2) or the MT1335WE
exploit in [Chapter D.4](#app04.xhtml_app04_4).

::: image
[]{#ch14.xhtml_page_142
.pagebreak}![Image](images/f0142-01.jpg){#ch14fig4}

> **Description:** Photograph of an EconoTAG r2 development board by Redwire LLC. The board features dual rows of header pins along both long edges, a central microcontroller, USB connector at the left end, multiple surface-mount components including crystals and capacitors, and an antenna connector. The board has a professional white silkscreen with component labels and the Redwire/red3d.org URLs printed on it. This is an IEEE 802.15.4 wireless development platform.

:::

Figure 14.4: Modified Econotag

[]{#ch15.xhtml}

