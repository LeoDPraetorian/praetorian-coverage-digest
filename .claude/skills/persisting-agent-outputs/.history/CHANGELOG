# Changelog - persisting-agent-outputs

## 2026-01-04 - Add Threat Modeling Context

**Added:**
- `.claude/.output/threat-modeling/{timestamp}-{target}/` to orchestrated contexts list
- Threat modeling as a recognized orchestration pattern alongside features, research, capabilities, and mcp-wrappers

**Context:**
- Supports threat-modeling-orchestrator workflow
- Enables agents to persist threat modeling outputs (architecture maps, control inventories, threat analysis) to standardized location

## 2026-01-04 - Blocked Status Field Definitions

**Added:**
- `blocked_reason` enum field: `security_concern`, `architecture_decision`, `missing_requirements`, `test_failures`, `out_of_scope`, `unknown`
- `attempted` array field for documenting what agent tried before blocking
- Blocked Agent example in metadata-format.md
- Conditional validation rules for blocked status
- Note in SKILL.md linking to blocked example

**Context:**
- Supports orchestrating-multi-agent-workflows agent routing table
- Enables orchestrators to route blocked agents based on `blocked_reason`
- `handoff.next_agent` should be `null` when blocked (orchestrator decides routing)

## 2026-01-04 - Orchestrator Context Support

**Added:**
- Step 0 in Discovery Protocol for parsing orchestrator-provided paths (HIGHEST PRIORITY)
- Support for multiple output path formats: OUTPUT_DIRECTORY:, Save to:, Write output to:, feature_directory:
- Path parsing logic for both directory-only and full-path-with-filename patterns
- Filename Resolution section explaining 3-tier priority (orchestrator → Primary output → convention)
- Directory Structure section documenting all orchestration contexts:
  - .claude/.output/features/ (orchestrating-feature-development)
  - .claude/.output/research/ (orchestrating-research)
  - .claude/.output/capabilities/ (orchestrating-fingerprintx-development)
  - .claude/.output/mcp-wrappers/ (orchestrating-mcp-development)
  - .claude/.output/agents/ (standalone)

**Changed:**
- WHERE description from single standalone pattern to "orchestrator context OR fallback"
- Step 1 renamed from "Explicit Parameter" to "Explicit feature_directory Parameter (Legacy)"
- Step 3 renamed from "Create New Directory" to "Create Standalone Directory (No Orchestrator Context)"
- Step 3 now includes preconditions (only use if Steps 0-2 don't apply)

**Renumbered:**
- Previous Step 1 → Step 1 (Legacy)
- Previous Step 2 → Step 2
- Previous Step 3 → Step 3

**Impact:**
- Agents now parse orchestrator paths from task prompts before falling back to legacy discovery
- Supports unified .claude/.output/ structure across all orchestrators
- Backward compatible with existing feature_directory parameter and standalone workflows
