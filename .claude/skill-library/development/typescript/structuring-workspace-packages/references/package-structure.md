# Package Structure

Directory layout and file organization patterns for TypeScript workspace packages.

## Provider Package Layout

```
@org/provider/
├── package.json          # Exports field, workspace config
├── tsconfig.json         # moduleResolution: bundler, declaration: true
├── src/
│   ├── index.ts          # Barrel export (re-exports all public APIs)
│   └── lib/
│       ├── module-a.ts   # Feature module A
│       ├── module-b.ts   # Feature module B
│       └── types.ts      # Shared types (optional)
├── dist/                 # Generated by tsc (gitignored)
│   ├── index.js
│   ├── index.d.ts
│   └── lib/
│       ├── module-a.js
│       ├── module-a.d.ts
│       ├── module-b.js
│       └── module-b.d.ts
└── __tests__/            # Unit tests (optional)
    └── module-a.test.ts
```

## Consumer Package Layout

```
@org/consumer/
├── package.json          # Dependencies: "@org/provider": "*"
├── tsconfig.json         # moduleResolution: bundler
├── src/
│   └── main.ts           # Entry point, imports from @org/provider
└── dist/                 # Generated if building (optional)
```

## Workspace Root Layout

```
workspace-root/
├── package.json          # workspaces array, root scripts
├── package-lock.json     # Single lockfile for all packages
├── node_modules/
│   └── @org/
│       ├── provider -> ../../packages/provider  # Symlink
│       └── consumer -> ../../packages/consumer  # Symlink
├── packages/
│   ├── provider/         # Provider package
│   └── consumer/         # Consumer package
└── tsconfig.base.json    # Shared compiler options (optional)
```

## Key Files

### Provider package.json

```json
{
  "name": "@org/provider",
  "version": "1.0.0",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js",
      "default": "./dist/index.js"
    },
    "./lib/*": {
      "types": "./dist/lib/*.d.ts",
      "import": "./dist/lib/*.js",
      "default": "./dist/lib/*.js"
    }
  },
  "files": ["dist"],
  "scripts": {
    "build": "tsc",
    "clean": "rm -rf dist"
  }
}
```

### Provider tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ES2022",
    "moduleResolution": "bundler",
    "outDir": "./dist",
    "rootDir": "./src",
    "declaration": true,
    "declarationMap": true,
    "strict": true,
    "esModuleInterop": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "**/*.test.ts"]
}
```

### Provider src/index.ts (Barrel)

```typescript
// Core exports
export { functionA, functionB, type TypeA } from "./lib/module-a.js";

export { functionC, type TypeB } from "./lib/module-b.js";

// Shared types
export type { CommonType } from "./lib/types.js";
```

### Consumer package.json

```json
{
  "name": "@org/consumer",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "start": "tsx src/main.ts"
  },
  "dependencies": {
    "@org/provider": "*"
  }
}
```

### Consumer tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ES2022",
    "moduleResolution": "bundler",
    "strict": true,
    "esModuleInterop": true,
    "noEmit": true
  },
  "include": ["src/**/*"]
}
```

### Root package.json

```json
{
  "name": "@org/workspace",
  "private": true,
  "type": "module",
  "workspaces": ["packages/*"],
  "scripts": {
    "build": "npm run build -ws --if-present",
    "test": "npm run test -ws --if-present",
    "clean": "npm run clean -ws --if-present"
  }
}
```

## Exports Field Patterns

### Single Entry Point

```json
{
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js"
    }
  }
}
```

### Multiple Subpaths

```json
{
  "exports": {
    ".": { "types": "./dist/index.d.ts", "import": "./dist/index.js" },
    "./utils": { "types": "./dist/utils.d.ts", "import": "./dist/utils.js" },
    "./lib/*": { "types": "./dist/lib/*.d.ts", "import": "./dist/lib/*.js" }
  }
}
```

### Wildcard Subpaths

```json
{
  "exports": {
    "./lib/*": {
      "types": "./dist/lib/*.d.ts",
      "import": "./dist/lib/*.js"
    }
  }
}
```

Allows: `import { x } from '@org/pkg/lib/anything'`

## Best Practices

1. **Keep src/ flat or shallow** - Deep nesting makes exports verbose
2. **One barrel per package** - Single index.ts for main exports
3. **Subpaths for internal modules** - When consumers need direct access
4. **Wildcards sparingly** - Explicit exports are easier to maintain
5. **Tests outside src/** - Keep **tests**/ at package root
6. **Gitignore dist/** - Generated files shouldn't be committed
