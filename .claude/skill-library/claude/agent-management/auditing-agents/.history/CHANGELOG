# Changelog

All notable changes to this skill.

## [2025-12-27] - PHASE 3: Add Skill tool requirement check to workflow-manual-checks.md

### Added
- **Step g** - New critical check: "If agent has skills: field with values ‚Üí Skill tool must be in tools: list"
- **Bash procedure** - Complete validation logic for checking Skill tool presence
- **Error messaging** - Clear output format with fix guidance and compliance contract reference
- **Example output** - Third example showing Skill tool check failure (architecture agent with skills but no Skill tool)
- **Why critical** - Explains runtime failure: agent cannot execute `skill: "name"` invocations without Skill tool

### Changed
- **Step labels** - Previous "g. Report Phase 3 result" ‚Üí "h. Report Phase 3 result"
- **Step labels** - Previous "h. Example output" ‚Üí "i. Example output"
- **Report criteria** - Updated PASS/ERROR criteria to include Skill tool check
- **Why critical** - Expanded to include Skill tool requirement alongside type safety

### Reason
- **Missing validation** - Phase 3 was NOT checking this requirement
- **Widespread impact** - Catches 4+ currently broken agents (backend-architect, security-lead, backend-developer, backend-reviewer)
- **Compliance alignment** - Implements agent-compliance-contract.md Section 12
- **Gold standard** - frontend-developer.md shows this is mandatory pattern

### Impact
- **Broken agents detected** - Audit will now catch all agents missing Skill tool when they have skills
- **Fix procedures** - fixing-agents must add procedure for this error
- **Prevention** - creating-agents and updating-agents must validate this

---

## [2025-12-27] - LEAN: Reduce to <120 lines, extract phase details to references

### Changed
- **Line count** - Reduced from 396 to 121 lines (69% reduction)
- **Structure** - Lean Quick Reference table + 3-step workflow
- **Phase 0 CLI** - Kept for critical deterministic checks
- **Manual phases** - Brief list, full procedures in workflow-manual-checks.md
- **Post-Audit Actions** - Simplified routing to fixing-agents

### Moved to References
- Phases 1-18 detailed procedures ‚Üí workflow-manual-checks.md (already exists)
- Examples ‚Üí examples.md (already exists)
- Technical details ‚Üí technical-details.md (already exists)
- Interpreting results ‚Üí interpreting-results.md (already exists)

### Kept in SKILL.md
- Quick Reference table (Phase 0 vs 1-18)
- When to Use (4 bullets)
- How to Use (3 steps: navigate, CLI, manual checks)
- Post-Audit Actions (routing table)
- Common Issues (3 scenarios with reference links)

### Reason
- **Alignment with gold standard**: Matches fixing-agents lean pattern
- **Progressive disclosure**: Details load on-demand via references
- **Maintainability**: Easier to scan and update
- **Token efficiency**: Core workflow visible, details referenced

### Impact
- Skill is now scannable (<120 lines target achieved)
- Phase 0 CLI still documented for critical checks
- All phase details preserved in existing reference files
- Post-audit routing simplified for faster decision-making

---

## [Date: 2025-12-27 - Add Phase 14g (Table Formatting Validation) documentation]

### Changed
- **Quick Reference section** - Added "Additional Automated Quality Checks (Deterministic)" subsection
  - Documents Phase 14g: Table Formatting Validation
  - Validates markdown tables using `npx prettier --check --parser markdown`
  - Severity: WARNING (auto-fixable with `npx prettier --write`)
  - References managing-agents/references/table-formatting.md for requirements

### Reason
- Phase 14g was implemented in the audit CLI but not documented in the skill
- Users need to know that table formatting is validated automatically
- Improves discoverability of deterministic validation phases beyond Phase 0

### Impact
- Users now understand that table formatting is automatically checked during audit
- Clear documentation of auto-fix capability for table formatting issues
- Links to table-formatting.md reference for detailed requirements

## [Date: 2025-12-27 - Update Post-Audit Actions with fixing-agents integration]

### Changed
- **Post-Audit Actions** - Updated action table to reference new fixing-agents capabilities
  - "Full fixing workflow" now describes three-tier orchestration (Deterministic, Claude-Automated, Hybrid, Human-Required)
  - "Deterministic only" now points to working CLI command: `npm run -w @chariot/fixing-agents fix -- <agent-name>`
  - "Show categorization" now references `phase-categorization.md` for complete phase mapping

### Reason
- fixing-agents skill was updated with three-tier fix model and CLI infrastructure
- Post-Audit Actions needed to reference these new capabilities for user workflow
- Ensures users can access all fix options after audit completes

### Impact
- Users can now access deterministic CLI fixes immediately after audit
- Users can view complete phase categorization to understand fix complexity
- Post-Audit Actions align with updated fixing-agents three-tier model

---

## [Date: 2025-12-27 - Add Mandatory Step 0: Repository Root Navigation]

### Added
- **Step 0: Navigate to Repository Root** - New mandatory step before "Skill Discovery" section
  - Bash command to navigate to super-repo root
  - Link to repo-root-detection.md reference
  - Anti-rationalization warning about "file not found" errors

### Reason
- Agents operating from submodule directories couldn't find agent files
- Incorrectly concluded agents were "built-in" when file existed at super-repo root

### Impact
- All audit operations now start by navigating to super-repo root
- Prevents "file not found" failures caused by wrong working directory

---

## [Date: 2025-12-26 - Update 23: Separate audit from skill discovery (single-responsibility)]

### Removed
- **Interactive Analysis Selection** section (lines 78-97 asking "Audit only / Find skills / Both")
- **--skills CLI flag** from Quick Reference table

### Added
- **Skill Discovery** section referencing `finding-skills-for-agents` skill
- This follows the pattern of `auditing-skills` which references `finding-agents-for-skills`

### Changed
- auditing-agents is now pure 18-phase audit only (no skill discovery prompts)
- Skill discovery delegated to new `finding-skills-for-agents` skill

### Reason
- **RED failure**: `/agent-manager audit` had interactive prompt asking users to choose between 3 options
- Violated Unix single-responsibility principle
- skill-manager already follows this pattern (audit vs find-agents are separate commands)
- Enables `/agent-manager find-skills <agent>` as separate command

### Impact
- Line count reduced: 346 ‚Üí 331 lines (-15 lines)
- Users can now run `/agent-manager audit <agent>` without prompts
- Users can run `/agent-manager find-skills <agent>` separately

---

## [Date: 2025-12-26 - Update 22: Add --skills flag for skill recommendations]

### Added
- **Interactive Analysis Selection**: Added AskUserQuestion workflow mirroring auditing-skills pattern
- **--skills CLI flag**: `npm run agent:audit -- <agent-name> --skills` now shows skill recommendations
- **skill-recommender.ts**: New module for agent‚Üískill matching (inverse of agent-analyzer.ts)
- **Quick Reference table**: Updated to include --skills command

### Fixed
- **Path pattern consistency**: Updated all command examples to use workspace shortcut `npm run agent:audit` from `.claude/` directory (matching auditing-skills pattern) instead of deep path to scripts directory
- Prevents "npm error Missing script" errors when running from wrong directory

### Implementation
- Created `scripts/src/lib/skill-recommender.ts` with:
  - `getAllSkillMetadata()`: Scans core + library skills
  - `getSkillRecommendations()`: Returns HIGH/MEDIUM/LOW confidence matches
  - `formatSkillRecommendationTable()`: ASCII table output
  - 100-point scoring: Domain (40) + Triggers (30) + Tools (15) + Related (15)
- Updated `audit-critical.ts` to:
  - Parse --skills flag
  - Show skill recommendations after audit results
  - Updated help text with new options

### Reason
- Symmetry with auditing-skills which has `--agents` flag
- auditing-skills: skill ‚Üí agents ("which agents should use this skill?")
- auditing-agents: agent ‚Üí skills ("which skills should this agent use?") ‚Üê NEW

### REFACTOR Phase
- **Required**: Major capability addition (new feature, not cosmetic)
- New scoring algorithm may need tuning based on real-world usage
- Pressure testing recommended to validate recommendations quality

---

## [Date: 2025-12-25 - Update 21: Rename "CLI audit" to "Phase 0"]

### Changed
- Renamed "CLI audit" to "Phase 0: Critical Validation" throughout skill
- Updated Quick Reference table to say "Phase 0: Critical checks"
- Updated todo list template: "Run Phase 0: Critical Validation (audit-critical CLI)"
- Updated Step-by-Step Audit Process section: "Phase 0: Critical Validation (TypeScript CLI)"
- Clarified progression: Phase 0 (AUTOMATED CLI) ‚Üí Phases 1-18 (MANUAL LLM reasoning)
- Updated "Why CLI Is Needed" section to "Why Phase 0 Uses CLI"
- Updated cli-rationale.md title to "Phase 0: Why CLI Validation Is Needed"

### Reason
- Inconsistent terminology caused confusion about audit workflow structure
- "CLI audit" appeared separate from numbered phases (1-18)
- Phase 0 makes clear it's the first step in sequential 0‚Üí1‚Üí2‚Üí...‚Üí18 workflow
- Emphasizes distinction between automated (Phase 0) vs manual (Phases 1-18) validation

### Preserved
- Command syntax unchanged: `npm run audit-critical` (actual CLI script name)
- Technical references to `audit-critical.ts` unchanged in code examples

### REFACTOR Phase
- **Not required**: Cosmetic-only change (terminology standardization)
- No logic changes, no validation rule changes, no workflow changes
- Change type: Documentary update (~15 term replacements)
- Per updating-skills Phase 8: REFACTOR optional for cosmetic changes

## [Date: 2025-12-25 - Update 20: Add Phase 18 (New Skill Discovery)]

### Added
- **Phase 18: New Skill Discovery** (INFO/WARNING-level optional check)
  - Added `Issue 22` documentation to SKILL.md Extended Structural Issues section
  - Created `references/phase-18-skill-discovery.md` with comprehensive 3-tier analysis procedures
  - Updated workflow manual checks list to include Phase 18 as optional step
  - Added AskUserQuestion to allowed-tools for user choice of analysis depth

### What Phase 18 Checks

**3-Tier Progressive Analysis:**

1. **Tier 1 - Gateway Coverage Analysis** (~2 min):
   - Finds skills from agent's gateways not yet in agent's Tier 3
   - Compares gateway routing tables with agent's skill triggers
   - Reports missing applicable skills with trigger suggestions

2. **Tier 2 - Orphaned Skill Detection** (~5 min):
   - Finds library skills in domain directories not integrated into ANY gateway
   - Scans domain directories (frontend/, backend/, testing/, etc.)
   - Reports orphaned skills needing gateway integration or archival

3. **Tier 3 - Miscategorization Detection** (~10 min):
   - Finds skills in wrong folders (frontend skill in backend/, etc.)
   - Analyzes skill content to infer intended domain
   - Reports miscategorized skills needing relocation

### Why Optional?

- Computationally expensive (2-10 minutes depending on tier)
- Primarily useful when:
  - Agent hasn't been updated recently
  - Skill library has grown since agent creation
  - Doing comprehensive agent review
  - Library maintenance/hygiene needed
- For routine audits, Phases 1-17 provide sufficient validation

### Results Interpretation

| Result           | Meaning                              | Action                                      |
| ---------------- | ------------------------------------ | ------------------------------------------- |
| N/A              | User skipped discovery               | No action needed                            |
| INFO (Tier 1)    | Found applicable skills not in agent | Review and add relevant skills to Tier 3    |
| WARNING (Tier 2) | Found orphaned skills                | Library maintenance: integrate or archive   |
| WARNING (Tier 3) | Found miscategorized skills          | Library maintenance: move to correct folder |

### Changed
- Updated SKILL.md overview to list Phase 18 (line 38)
- Updated Extended Structural Issues to include Issue 22 (line 157)
- Updated Recommended Todo List from 18 to 19 steps (line 172)
- Updated manual checks from "Phases 18, 17..." to "Phases 18, 17..." with Phase 18 reference (line 211)
- Updated "17+ manual phases" to "18+ manual phases" in workflow rationale (line 192)
- Added frontmatter: `allowed-tools: Bash, Read, TodoWrite, AskUserQuestion`

### Reason
- **RED failure**: When auditing agents, there's no mechanism to discover skills that should be added based on:
  - Agent's gateways (gateway routes to 25 skills, agent only has 10)
  - Library orphans (skills exist but not in any gateway)
  - Miscategorization (frontend skill in backend/ folder)
- Phase 18 fills this gap with optional progressive analysis
- User chooses analysis depth via AskUserQuestion (skip / tier 1 / tier 1+2 / full)
- Non-blocking allows flexibility for routine vs comprehensive audits

---

## [Date: 2025-12-25 - Update 19: Mandatory TodoWrite for All Audits]

### Changed
- Updated MANDATORY note from "when checking multiple agents" to "for all audits to ensure no phases are skipped"
- Added "Recommended Todo List" section in Workflow showing standard 18-step checklist
- TodoWrite now required for ALL audits (single or multiple agents)

### Added
- **Recommended Todo List** (18 steps):
  1. Run CLI audit
  2-15. Manual phases 17-1 (in reverse order as performed)
  16. Consolidate results
  17. Apply fixes
  18. Re-audit to verify
- Rationale section explaining why todos are mandatory (17+ phases easy to skip)

### Reason
- **RED failure**: With 17+ manual phases, even single-agent audits benefit from systematic checklist
- Without standard todo template, auditors may skip phases, complete out of order, or forget to consolidate/re-audit
- TodoWrite provides progress tracking and prevents oversight

---

## [Date: 2025-12-25 - Update 18: Add Phase 17 (Skill Content Duplication Detection)]

### Added
- **Phase 17: Skill Content Duplication Detection** (WARNING-level manual check)
  - Added `Issue 21` documentation to `references/extended-issues.md`
  - Added `Phase 17` manual check procedure to `references/workflow-manual-checks.md`
  - Updated SKILL.md to reference new phase in Extended Structural Issues section
  - Updated workflow manual checks list to include Phase 17

### What Phase 17 Checks
- Detects when agent body content duplicates information covered by existing skills
- Identifies instructional content (>100 chars): patterns, workflows, methodologies, rules
- Uses skill-search CLI to find potentially matching skills
- Confirms overlap by reading candidate skill SKILL.md files
- Reports duplications with: section location, overlapping skill path, fix suggestion

### Common Duplication Targets
- TDD workflow steps ‚Üí `developing-with-tdd`
- Debugging procedures ‚Üí `debugging-systematically`
- Verification checklists ‚Üí `verifying-before-completion`
- Refactoring patterns ‚Üí `adhering-to-dry`
- Scope discipline ‚Üí `adhering-to-yagni`
- Time estimation rules ‚Üí `calibrating-time-estimates`
- Planning workflows ‚Üí `writing-plans`
- React patterns ‚Üí `using-modern-react-patterns`

### Why Manual?
This is a reasoning/judgment task that requires:
- Semantic understanding of what content "means"
- Judgment about whether content is truly duplicated vs agent-specific
- Knowledge of the skill ecosystem to find matches
- Decision-making about appropriate fixes

Cannot be automated with simple grep patterns - requires Claude's reasoning.

### Why Important?
Content duplication causes:
- Agent bloat (same content in multiple places)
- Maintenance burden (updates in multiple locations)
- Version drift (agent content may become stale)
- Token waste (redundant content in context window)
- Architecture violation (defeats lean agent pattern <300 lines)

### Fix Pattern
Delete duplicated sections and add Tier 3 skill triggers instead:
```markdown
# Before (embedded TDD workflow - 50+ lines)
## Development Workflow
When implementing features, follow TDD...

# After (Tier 3 skill reference - 2 lines)
| Implementing features | `.claude/skills/developing-with-tdd/SKILL.md` |
```

---

## [Date: 2025-12-25 - Update 17: Expand Body Trigger Patterns]

### Added
- **Phase 13 (Body Trigger Analysis)**: 10 new trigger patterns (was 3, now 13 total)
  1. `brainstorm|explore alternatives|design options` ‚Üí brainstorming
  2. `time estimate|how long|duration` ‚Üí calibrating-time-estimates
  3. `plan|implementation steps|task breakdown` ‚Üí writing-plans
  4. `parallel|concurrent|multiple agents` ‚Üí dispatching-parallel-agents
  5. `security|vulnerability|OWASP|auth` ‚Üí gateway-security
  6. `todo|checklist|track progress` ‚Üí using-todowrite
  7. `refactor|clean code|DRY` ‚Üí adhering-to-dry
  8. `scope|minimal|YAGNI` ‚Üí adhering-to-yagni
  9. `state management|zustand|redux` ‚Üí gateway-frontend
  10. `API|endpoint|REST|GraphQL` ‚Üí gateway-backend

### Changed
- Updated `workflow-manual-checks.md` Phase 13 body trigger section with all 10 new patterns
- Updated example output to show multiple body triggers detected (was 1, now shows 5)
- Updated `extended-issues.md` Issue 19 with complete detection logic for all 13 patterns

### Reason
- **Under-triggering prevention**: Only 3 trigger patterns were detecting skill gaps - agents with body content describing brainstorming, planning, parallel execution, security, etc. were not getting suggestions
- **Improved discovery**: Auditors can now suggest 10 additional skills based on what agents describe doing

---

## [Date: 2025-12-25 - Update 16: Universal Tier 1 Skills Enforcement]

### Changed
- **Phase 13 (Skill Gap Analysis)**: Universal skills now WARNING severity (was INFO)
  - `verifying-before-completion` and `calibrating-time-estimates` are now MANDATORY for ALL agents
  - Missing universal skills now report as ‚ö†Ô∏è WARNING (must be fixed)
  - Type/domain skills remain INFO (suggestions)
- Updated `workflow-manual-checks.md` Phase 13 to check universal skills first with WARNING severity
- Updated `extended-issues.md` Issue 19 to clarify universal vs type-specific skills

### Reason
- **Consistency**: These skills prevent fundamental errors (incomplete work, time estimation) across ALL agents
- **Enforcement**: INFO was too weak - agents were skipping these essential skills
- **Coordination**: Part of three-skill update (auditing-agents, creating-agents, updating-agents)

---

## [Date: 2025-12-25 - Update 15: Add Phase 16 Markdown Table Formatting]

### Added
- **Phase 16: Markdown Table Formatting** (WARNING-level quality check)
  - Added `Issue 20` documentation to `references/extended-issues.md`
  - Added `Phase 16` manual check procedure to `references/workflow-manual-checks.md`
  - Updated SKILL.md to reference new phase in Extended Structural Issues section
  - Updated workflow manual checks list to include Phase 16
- **Checks for**:
  - Consistent column counts across header, separator, and data rows
  - Proper header separator format (`|---|---|` with 3+ dashes)
  - Aligned pipe characters
  - Table structure consistency

### Changed
- Manual checks now include phases 16-1 (was 15-1)
- Extended Issues list now includes 20 issues (was 19)

### Reason
- **RED failure**: Agents can have poorly formatted markdown tables with inconsistent columns, malformed separators, or misaligned pipes without any audit warnings
- **Improves**: Documentation quality, maintainability, parser compatibility, and readability
- **Non-blocking**: WARNING-level check (not CRITICAL) since agents function with poorly formatted tables

### REFACTOR Pressure Testing
- **Scope**: Documentation-only addition, follows existing manual phase pattern
- **Pressure scenarios tested**:
  1. Time pressure: "No time for formatting checks" ‚Üí Counter: Takes 2-3 minutes, part of workflow
  2. Authority: "Doesn't affect functionality" ‚Üí Counter: Acknowledged as WARNING, improves quality
  3. Sunk cost: "Already did 15 phases" ‚Üí Counter: Must complete all manual phases per workflow
- **Rationalization prevention**: Explicit severity levels, "Why Important" section, non-blocking status documented
- **Result**: No additional counters needed, appropriately scoped as quality check

## [Date: 2025-12-25 - Update 14: Progressive Disclosure Refactor]

### Changed
- **Reduced SKILL.md from 2,188 words to 1,308 words** (40% reduction)
- **Extracted CLI rationale** to `references/cli-rationale.md`
  - Moved lines 330-356 (CLI justification, division of responsibilities)
  - Replaced with brief 2-line summary + reference link
- **Condensed workflow section** to eliminate duplicate content
  - Removed duplicate manual check checklist (lines 173-193)
  - Content already exists in `references/workflow-manual-checks.md`
  - Replaced with single-line reference
  - Condensed "Consolidate Results" section (removed per-phase list)
  - Condensed "Fix Each Issue" section (removed detailed fix list)
  - Condensed "Re-Audit" section (removed phase-by-phase repetition)
  - Condensed "Verify Success" section (removed per-phase list)

### Added
- `references/cli-rationale.md` - Complete justification for CLI implementation
  - Why LLMs can't replace regex-based validation
  - Division of responsibilities between skill and CLI
  - Historical failure rates (8/10 before enforcement)
  - When to use instruction-based vs CLI approaches

### Reason
- **Audit Phase 3 failure**: Word count exceeded 1,500-word limit for hybrid skills
- Progressive disclosure principle: SKILL.md should be overview + references
- Duplicate content across multiple sections increased maintenance burden

### Impact
- ‚úÖ Now complies with progressive disclosure requirements
- ‚úÖ Improved readability with clearer structure
- ‚úÖ Reduced duplication (DRY principle)
- ‚úÖ Easier maintenance (single source of truth in references)

### REFACTOR Phase Documentation

**Phase 8 (üîµ REFACTOR) - Mandatory for structural changes**

**Pressure Test Scenarios:**
1. **Time Pressure**: "Can I skip extracting to references and just inline the changes?"
   - ‚ùå NO - Word count limit is HARD requirement (1,500 words for hybrid skills)
   - ‚úÖ Extraction maintains compliance while preserving content

2. **Authority Rationalization**: "This content is too important to hide in references"
   - ‚ùå NO - Progressive disclosure improves findability, not hides content
   - ‚úÖ References are linked prominently, easier to navigate than monolithic file

3. **Sunk Cost Fallacy**: "We already wrote detailed checklists in SKILL.md"
   - ‚ùå NO - Duplicate content creates maintenance burden (DRY violation)
   - ‚úÖ Single source of truth in references reduces errors

**Loopholes Closed:**
- "Word count is just a guideline" ‚Üí NO, it's a HARD limit (audit fails >1,500)
- "Hybrid skills can be longer" ‚Üí NO, hybrid = 600-1,200 optimal, 1,500 max
- "We can inline 'just this one section'" ‚Üí NO, must follow extraction workflow

**Test Results:**
- ‚úÖ Word count reduced from 2,188 ‚Üí 1,308 (880 words / 40.2% reduction)
- ‚úÖ Audit passed with 0 critical issues
- ‚úÖ All references link correctly
- ‚úÖ Content preserved in references/ for detailed access
- ‚úÖ No functionality lost, improved navigation

**Anti-Bypass Measures:**
- Audit Phase 3 enforces word count limits programmatically
- Cannot commit skill with >1,500 words
- Progressive disclosure is mandatory, not optional

---

## [Date: 2025-12-25 - Update 13: Add Phase 13 (Skill Gap Analysis)]

### Changed
- Added Phase 13 (Skill Gap Analysis) to manual check workflow
- Renumbered old Phase 13 (Deprecated Pattern Detection) to Phase 14
- Renumbered old Phase 14 (Library Skill Path Validation) to Phase 15
- Updated SKILL.md:
  - Added Phase 13 to extended checks list (line 36)
  - Added Issue 19 (Missing Recommended Skills) to extended issues list (line 152)
  - Updated workflow checklist to include Phase 13 (line 180)
  - Updated consolidation results section with Phase 13 (line 200)
  - Updated fix instructions to include Phase 13 guidance (line 224)
  - Updated re-audit checklist with Phase 13 (line 248)
  - Updated verification section with Phase 13 (line 266)
- Updated references/workflow-manual-checks.md:
  - Added complete Phase 13 procedure (lines 547-668)
  - Includes type-based, domain-based, and body trigger analysis
  - Renumbered old Phase 13 to Phase 14 (line 671)
  - Renumbered old Phase 14 to Phase 15 (line 764)
- Updated references/extended-issues.md:
  - Added Issue 19: Missing Recommended Skills (lines 982-1109)
  - Includes detection logic, type/domain mappings, fix procedures
  - Updated Phase 14 to Phase 15 references (line 973)

### Added
- **Phase 13 Detection Logic:**
  1. Type-based required skills (development, quality, testing, all types)
  2. Domain-based recommended gateways (frontend, backend, testing, security)
  3. Body trigger analysis (TDD mentions, debug mentions, verify mentions)
- **Type ‚Üí Skills Mapping:**
  - development ‚Üí developing-with-tdd, adhering-to-yagni, adhering-to-dry
  - quality ‚Üí analyzing-cyclomatic-complexity (Tier 3)
  - testing ‚Üí developing-with-tdd
  - All types ‚Üí verifying-before-completion, calibrating-time-estimates
- **Domain ‚Üí Gateway Mapping:**
  - frontend/react/ui ‚Üí gateway-frontend
  - backend/go/api ‚Üí gateway-backend
  - test ‚Üí gateway-testing
  - security ‚Üí gateway-security

### Severity
- ‚ö†Ô∏è INFO (suggestions only, not blocking)
- Provides recommendations but doesn't fail audit

### Reason
- Current audit only detects missing skills (Phase 7) and wrong location (Phase 10)
- Doesn't suggest beneficial skills based on agent type and purpose
- Phase 13 helps maintain consistency across similar agent types
- Improves agent effectiveness by suggesting methodology skills (TDD, verification, debugging)
- Non-blocking allows flexibility for special cases

## [Date: 2025-12-25 - Update 12: Elevate Phase 9 to CRITICAL Severity]

### Changed
- Phase 9 (Skill Loading Protocol) changed from WARNING to CRITICAL severity
- Updated SKILL.md description: Phase 9 now marked as "(critical)" instead of "(warning)"
- Updated extended-issues.md: Issue 12 header changed to "(Critical - Phase 9)"
- Added requirement for all 3 components: Tiered Protocol + Anti-Bypass + skills_read in output JSON
- Updated workflow manual checks: Phase 9 now records PASS/ERROR/N/A instead of PASS/WARNING/N/A
- Updated verification section: Phase 9 errors now block proceeding (must fix before deployment)

### Reason
- Phase 9 violations break skill enforcement at runtime (agents skip reading skills)
- Missing Skill Loading Protocol = ~20% skill usage vs 80%+ with protocol
- Missing Anti-Bypass section = agents rationalize skipping skill reads
- Missing skills_read in output = no verification skills were actually loaded
- These are blocking issues that must be fixed before agent deployment
- Aligns severity with impact: discovery blockers (Phase 1-5) and enforcement blockers (Phase 9-10) are both critical

### REFACTOR Tests
Ran 3 pressure test scenarios, all passed:
1. Time pressure ("fix later") - ‚úÖ CRITICAL severity + blocking language prevents deferral
2. Partial compliance - ‚úÖ "All 3 components MANDATORY" prevents partial implementations
3. Scope minimization - ‚úÖ ERROR severity blocks proceeding with incomplete fixes

---

## [Date: 2025-12-24 - Update 11: Workflow Manual Checks Phase 9 Migration]

### Changed
- Updated `references/workflow-manual-checks.md` Phase 9 for Claude 4.5+ pattern
- Replaced "Explicit Skill Invocation" title with "Skill Loading Protocol"
- Removed EXTREMELY_IMPORTANT block verification procedure (5 steps)
- Added Tiered Skill Loading Protocol verification (4 grep checks)
- Verification now checks for: ## Skill Loading Protocol, ### Tier [123], ## Anti-Bypass, skills_read
- Simplified from 5-step procedure to 4 grep commands
- Results unchanged: PASS/WARNING/N/A (same semantics, different checks)

### Reason
- Final step of AGENT-UPDATE-NEW-PROMPT.md migration plan (Phase 4.3)
- Completes auditing-agents alignment with Claude 4.5+ pattern
- Manual audit instructions now check for correct pattern (no legacy references)
- Agents audited with Phase 9 manual check will verify Tiered Skill Loading Protocol
- Grep-based verification is simpler than multi-step text matching
- All three files now consistent: SKILL.md, extended-issues.md, workflow-manual-checks.md

---

## [Date: 2025-12-24 - Update 10: Extended Issues Phase 9 Migration]

### Changed
- Updated `references/extended-issues.md` Issue 12 for Claude 4.5+ pattern
- Replaced "Missing Explicit Skill Invocation" with "Missing Skill Loading Protocol"
- Removed entire EXTREMELY_IMPORTANT template (122 lines) and legacy guidance
- Added new Tiered Skill Loading Protocol template with Tier 1/2/3 structure
- Updated detection commands to check for "## Skill Loading Protocol" section
- Added reference to `creating-agents/references/tiered-skill-loading-protocol.md` template
- Reduced Issue 12 from ~122 lines to ~56 lines (54% reduction)

### Reason
- Continuation of AGENT-UPDATE-NEW-PROMPT.md migration plan (Phase 4.2)
- Extended issues reference must align with creating-agents' new patterns
- Agents audited with this skill now get 4.5+ pattern guidance, not legacy
- Removed aggressive language ("MUST", "CRITICAL", "not optional") from Fix section
- New pattern uses Read() for skills instead of Skill tool invocation
- Template provides concrete example with Tier 1/2/3 breakdown and Anti-Bypass section

---

## [Date: 2025-12-24 - Update 9: Claude 4.5+ Pattern Migration]

### Changed
- Updated Phase 9 description from "EXTREMELY_IMPORTANT block" to "Tiered Skill Loading Protocol"
- Updated Issue 12 title from "Missing EXTREMELY_IMPORTANT Block" to "Missing Skill Loading Protocol"
- Updated workflow checklist Phase 9 from "EXTREMELY_IMPORTANT block" to "Tiered Skill Loading Protocol"
- Updated workflow re-audit section Phase 9 from "EXTREMELY_IMPORTANT block" to "Tiered Skill Loading Protocol"

### Reason
- Aligning with AGENT-UPDATE-NEW-PROMPT.md migration plan (Phase 4.1)
- creating-agents skill completed Phase 1-2 migration (removed all legacy EXTREMELY_IMPORTANT patterns)
- Agents now use Tiered Skill Loading Protocol (Tier 1/2/3 + Anti-Bypass) instead of aggressive language
- Claude 4.5 overtriggers on "MUST", "CRITICAL", "ALWAYS" - new pattern uses direct language
- This update ensures auditing-agents checks for the correct 4.5+ pattern

---

## [Date: 2025-12-13 - Update 8: Frontmatter Organization Check]

### Changed
- Added Phase 1 manual check: Frontmatter Organization (after Phase 2 in Step 3 workflow)
- Workflow now validates frontmatter fields appear in canonical order
- Canonical order: name, description, type, permissionMode, tools, skills, model, color
- Instructions: 1) Extract raw frontmatter, 2) Parse field order, 3) Compare to canonical, 4) Report out-of-order fields
- Reports WARNING for out-of-order fields (not ERROR - this is maintenance/consistency, not functional)
- Renamed old Phase 1 (PermissionMode Alignment) to Phase 0 to maintain numbering clarity
- Updated all workflow references from "Phases 9,8,7,4,3,2,1" to "Phases 9,8,7,4,3,2,1,0"

### Reason
- Maintenance and consistency: Consistent field ordering reduces merge conflicts and improves readability
- Makes diffs more predictable when multiple developers edit agents
- Easier to spot missing required fields when fields follow standard order
- This is a LOW-MEDIUM PRIORITY check (maintenance issue, not functional)
- Instruction-based: parse YAML line by line and check order against canonical list
- Complements existing structural checks with organizational consistency

---

## [Date: 2025-12-13 - Update 7: Tool Validation Check]

### Changed
- Added Phase 2 manual check: Tool Validation (Step 7 in workflow)
- Workflow now validates agents have appropriate tools for their type
- Type ‚Üí Required Tools: development‚Üí[Edit,Write,Bash], testing‚Üí[Bash]
- Type ‚Üí Forbidden Tools: quality‚Üí[Edit,Write], analysis‚Üí[Edit,Write] (read-only)
- Reports ERROR for missing required tools or forbidden tools present
- Optional suggestions: architecture‚Üí[Read,Glob,Grep,TodoWrite], orchestrator‚Üí[Task,TodoWrite]
- Restructured workflow from 11 steps (Phases 9,7,4,3,1) to 12 steps (Phases 9,7,4,3,2,1)

### Reason
- Type safety: ensures agents can only perform operations appropriate for their role
- Quality/analysis agents MUST be read-only (can't have Edit/Write)
- Development agents MUST be able to write code (requires Edit/Write/Bash)
- Testing agents MUST be able to run tests (requires Bash)
- This is a HIGH PRIORITY check (type safety / security issue)
- Instruction-based: simple field comparison and list checking, no TypeScript needed
- Prevents misuse: quality reviewers modifying code they're reviewing, architecture agents writing during planning phase

---

## [Date: 2025-12-13 - Update 6: Progressive Disclosure Refactor]

### Changed
- **MAJOR REFACTOR**: Implemented progressive disclosure pattern
- Extracted 6 sections to `references/` directory (868 lines total)
- Reduced main SKILL.md from 1167 lines to 326 lines (72% reduction)
- All detailed content now loads on-demand via reference links

**Reference files created:**
- `references/common-issues.md` (130 lines) - Issues 1-5 detailed troubleshooting
- `references/extended-issues.md` (258 lines) - Issues 6-12 with templates
- `references/interpreting-results.md` (107 lines) - Exit code interpretation
- `references/examples.md` (80 lines) - Workflow examples
- `references/technical-details.md` (85 lines) - CLI implementation details
- `references/workflow-manual-checks.md` (208 lines) - Phase 9/7/4/3/1 procedures

### Reason
- **Violated updating-skills Phase 4.3 and 7.2** - Added 5 updates without extracting content
- File grew from 921 ‚Üí 1167 lines (133% over target) by ignoring progressive disclosure requirements
- **This is the fix** - Now compliant with <500 line target (326 lines, 174 under target)
- Context efficiency: 72% reduction in initial load, detailed content loads on-demand
- Maintainability: Modular sections easier to update and navigate

---

## [Date: 2025-12-13 - Update 5]

### Changed
- Added Phase 1 manual check: PermissionMode Alignment (Step 7 in workflow)
- Workflow now validates permissionMode matches agent type for security
- Type‚ÜípermissionMode mapping: architecture/quality/analysis‚Üíplan, all others‚Üídefault
- Reports ERROR for mismatches with security implications explained
- Restructured workflow from 11 steps to 12 steps

### Reason
- Security risk: wrong permission level allows unauthorized operations
- Architecture/quality/analysis agents MUST be read-only (plan mode)
- Development/testing agents need write permissions (default mode)
- This is a MEDIUM-HIGH PRIORITY check (security issue)
- Instruction-based: simple field comparison, no TypeScript needed
- Phase 1 was in archived code but not in current workflow

---

## [Date: 2025-12-13 - Update 4]

### Changed
- Added Phase 3 manual check: Pattern Delegation (Step 6 in workflow)
- Workflow now checks for embedded workflow patterns that should be delegated to skills
- Detects: TDD workflows (RED-GREEN-REFACTOR), debugging steps, verification checklists >5 items
- Only flags patterns >200 chars (threshold for bloat)
- Reports WARNING with skill delegation suggestions
- Restructured workflow from 10 steps to 11 steps

### Reason
- Embedded patterns cause agent bloat (>300 lines), duplication, harder maintenance
- Lean agent pattern requires delegating to skills instead of embedding
- This is a MEDIUM PRIORITY check (maintainability issue)
- Instruction-based: keyword search + character counting, no TypeScript needed
- Phase 3 was in archived code but not in current workflow

---

## [Date: 2025-12-13 - Update 3]

### Changed
- Added Phase 4 manual check: Gateway Enforcement (Step 5 in workflow)
- Workflow now checks if agents use direct library paths instead of gateway-* skills
- Instructions include: read skills: frontmatter, check for path separators, detect .claude/skill-library/ references
- Reports ERROR for direct paths with gateway replacement suggestions
- Restructured workflow from 9 steps to 10 steps

### Reason
- Direct library paths defeat progressive loading architecture
- Causes high token costs at agent spawn (defeats gateway pattern)
- This is a MEDIUM-HIGH PRIORITY check (architectural violation)
- Instruction-based: simple text pattern check, no TypeScript needed
- Phase 4 was in archived code but not in current workflow

---

## [Date: 2025-12-13 - Update 2]

### Changed
- Added Phase 7 manual check: Phantom Skills Detection (Step 4 in workflow)
- Workflow now checks for skills referenced in agent body via `skill: "name"` that don't exist
- Instructions include: grep for skill patterns, extract names, verify file existence
- Reports ERROR for phantom skills (functional failure, not cosmetic)
- Restructured workflow from 8 steps to 9 steps

### Reason
- Phantom skills cause runtime failures when agents try to invoke non-existent skills
- This is a HIGH PRIORITY check (functional error)
- Instruction-based: simple grep + file existence, no TypeScript needed
- Phase 7 was in archived code but not in current workflow

---

## [Date: 2025-12-13 - Update 1]

### Changed
- Added Phase 9 manual check instructions to workflow section (Step 3)
- Workflow now includes instruction-based check for EXTREMELY_IMPORTANT blocks
- Restructured workflow from 6 steps to 8 steps with explicit Phase 9 verification
- Added checklist for verifying block contains: absolute language, invocation syntax, anti-rationalization, validation warning

### Reason
- Phase 9 was documented in "Extended Structural Issues" (lines 495-608) but missing from workflow
- Users running audits didn't know to manually check for EXTREMELY_IMPORTANT blocks
- Clarified that Phase 9 is instruction-based (Claude reads and checks), not TypeScript-based
- Simple text matching doesn't require complex regex like block scalar detection

---

- **2025-12-13**: Add Phase 9: Explicit Skill Invocation Verification. Check that agents with mandatory skills include: 1) EXTREMELY_IMPORTANT block at top of prompt with 'You MUST explicitly invoke' language, 2) Each mandatory skill lists explicit invocation syntax, 3) Anti-rationalization patterns listed (based on obra/superpowers pattern), 4) Warning about validation failure if skills not invoked. This is separate from checking skills: frontmatter field - that's Phase 4.
## [Date: 2025-12-25 - Update 13: Add Phase 13 (Deprecated Patterns) and Phase 14 (Library Skill Paths)]

### Changed
- Added Phase 13: Deprecated Pattern Detection to workflow-manual-checks.md
  - Detects `<EXTREMELY_IMPORTANT>` blocks (obsolete pre-Protocol pattern)
  - Detects duplicate "Mandatory Skills (Must Use)" sections
  - Detects duplicate "Rationalization Table" sections
  - Detects duplicate skill trigger tables across multiple sections
  - Reports ERROR for `<EXTREMELY_IMPORTANT>`, WARNING for duplicate sections
  - Provides fix guidance: delete blocks, consolidate duplicates into Protocol/Anti-Bypass

- Added Phase 14: Library Skill Path Validation to workflow-manual-checks.md
  - Validates all library skill paths referenced in agent body exist
  - Detects renamed skills not yet in deprecation registry (frontend-tanstack-query ‚Üí using-tanstack-query)
  - Reports ERROR for invalid/non-existent paths
  - Provides fix guidance: update paths, check deprecation registry

- Added Issue 16 to extended-issues.md: Deprecated Pattern Duplication
  - Documents problem: agents accumulate 2-4x bloat from obsolete patterns
  - Example: frontend-architect 512 lines with 276 deletable vs frontend-developer 130 line gold standard
  - Detection methods with grep patterns
  - Fix patterns showing before/after cleanup
  - Consolidation guidelines for each deprecated pattern type

- Added Issue 17 to extended-issues.md: Invalid Library Skill Paths
  - Documents problem: agents reference non-existent skills after renames
  - Common renamed skills table (frontend-tanstack-query, etc.)
  - Detection methods with file existence checks
  - Fix procedures for renamed vs removed skills

- Updated main SKILL.md workflow section:
  - Added Phase 13 and 14 to Quick checklist
  - Added Phase 13 and 14 to Check Exit Codes section
  - Added Phase 13 and 14 to If Issues Found section
  - Added Phase 13 and 14 fix guidance to Fix Each Issue section
  - Added Phase 13 and 14 to Re-Audit repeat checks
  - Added Phase 13 and 14 to Verify Success criteria

### Reason
- Phase 13 needed: frontend-architect audit showed 512 lines with 276 lines of deletable duplication from deprecated patterns that current audit doesn't catch
- `<EXTREMELY_IMPORTANT>` blocks are obsolete (pre-date Tiered Skill Loading Protocol)
- Duplicate sections cause 2-4x file bloat and maintenance nightmares
- Phase 14 needed: frontend-architect references frontend-tanstack-query (renamed to using-tanstack-query) that current audit doesn't catch
- Invalid skill paths cause runtime failures when agents try to Read non-existent files
- Both phases prevent technical debt accumulation and broken skill loading

### Evidence from frontend-architect Audit
Before adding these phases:
- ‚úÖ All existing phases (1-12) passed
- ‚ùå Phase 13 violations not detected: 276 lines of deletable duplication (77+144+14+41)
- ‚ùå Phase 14 violations not detected: Invalid path to frontend-tanstack-query

After cleanup (projected):
- frontend-architect: 512 lines ‚Üí 236 lines (54% reduction)
- Matches frontend-developer gold standard pattern (130 lines)
- All library skill paths valid

### REFACTOR Tests
Not yet performed - will test with frontend-architect cleanup to verify:
1. Phase 13 detects all 4 deprecated pattern types
2. Phase 14 catches renamed skill paths
3. Fix guidance successfully reduces agent from 512 to ~236 lines
4. Cleanup maintains agent functionality


## 2025-12-26 - Complete skill discovery refactor

**Changed:**
- Removed Phase 18 (New Skill Discovery) entirely - functionality moved to `finding-skills-for-agents` skill
- Simplified Phase 13 to MANDATORY universal skill validation only (verifying-before-completion, calibrating-time-estimates)
- Fixed phase ordering in todo list: changed from reverse (18‚Üí1) to ascending (0‚Üí17)
- Added documentation for Phases 10, 11, 12 in workflow-manual-checks.md
- Updated phase count from "18+ manual phases" to "17 manual phases"

**Reason:**
- Phase 18 was announced as split to finding-skills-for-agents (2024-12-26 changelog) but remained in audit workflow
- Phase 13 overlapped with finding-skills-for-agents functionality (domain/trigger-based discovery)
- Todo list and workflow-manual-checks.md had inconsistent phase ordering
- Phases 10, 11, 12 were mentioned in SKILL.md but undocumented in reference file

**Files modified:**
- SKILL.md: Removed Phase 18, updated todo list, simplified Phase 13 description
- references/workflow-manual-checks.md: Removed Phase 18 section (330 lines), added Phases 10-12 documentation, simplified Phase 13 procedure


**REFACTOR testing:**
- Pressure scenarios tested: Completeness, Authority, Sunk Cost, Complexity
- All scenarios PASSED - changes maintain integrity
- Rationalizations blocked: partial removal, keeping comprehensive Phase 13, ignoring ordering
- Verified: Phase 18 functionality fully migrated to finding-skills-for-agents
- Verified: Phase 13 simplified to MANDATORY universal skills only
- Verified: Phase ordering consistent across SKILL.md and workflow-manual-checks.md

## [Changed] - 2025-12-26

### What Changed
- Added "Post-Audit Actions" section (lines 261-298) to prompt users after audit completion

### Why (RED Failure)
- Users were not prompted to run fixing-agents workflow after audit found issues
- Required manual decision-making without clear guidance on next steps
- Inconsistent with auditing-skills pattern which prompts for fixing-skills

### Implementation Details
- Uses AskUserQuestion to offer 4 options: full fixing workflow, deterministic only, show categorization, or skip
- Provides routing table for each selection
- Example invocation shows how to invoke fixing-agents skill
- Clarifies when NOT to prompt (success with no issues)

### Impact
- Improves user experience by providing clear post-audit workflow guidance
- Aligns auditing-agents with auditing-skills interaction pattern
- Reduces cognitive load for users deciding what to do after audit


### REFACTOR Phase
- Assessed pressure scenarios: time pressure, authority, repeated use
- Risk level: LOW (documentation-only change, no enforcement)
- No counter-bypass strengthening needed (clear triggers, explicit exceptions, AskUserQuestion)
- Change improves UX consistency without introducing bypass risks
