# Changelog

All notable changes to the auditing-skills skill.

## [2025-12-31] - Fix Semantic Review JSON Confusion

### Changed
- **Semantic Review Checklist**: Removed "(CSO)" suffix from "Description Quality (CSO)" criterion name
  - Before: "Description Quality (CSO)" in checklist
  - After: "Description Quality" (matches schema validation)
  - Reason: The "(CSO)" caused Claude to use wrong criterion name in JSON, failing schema validation

### Added
- **Inline JSON Example**: Added explicit example showing correct semantic findings structure
  - Shows exact field names: `severity`, `criterion`, `issue`, `recommendation`
  - Includes warning: "Required fields: ... (NOT 'phase'!)"
  - Prevents confusion between structural phase output and semantic criterion field

### Why This Matters
- Claude was copying "Description Quality (CSO)" from checklist into JSON
- Schema validation rejected it (only accepts "Description Quality")
- Adding inline example prevents need to navigate to reference file
- Explicit "NOT 'phase'!" warning prevents wrong field name

### Files Changed
- `SKILL.md` line 174: Removed "(CSO)" from criterion name
- `SKILL.md` lines 208-225: Added inline JSON example with explicit field requirements

---

## [2025-12-31] - Simplify Repository Root Navigation Pattern

### Changed
- **Repository Root Detection**: Replaced complex 3-line pattern with simplified industry-standard approach
  - Before: Three separate commands with stderr redirect and conditional test
  - After: Single combined git command with pipe to `head -1`
  - Variable rename: `REPO_ROOT` → `ROOT` for consistency with command files and MCP tools

### Technical Details
**Old Pattern (Lines 66-68, 89-91):**
```bash
REPO_ROOT=$(git rev-parse --show-superproject-working-tree 2>/dev/null)
test -z "$REPO_ROOT" && REPO_ROOT=$(git rev-parse --show-toplevel)
cd "$REPO_ROOT"
```

**New Pattern:**
```bash
ROOT="$(git rev-parse --show-superproject-working-tree --show-toplevel | head -1)" && cd "$ROOT"
```

**Why This Is Better:**
- Single git command with both flags (--show-superproject-working-tree and --show-toplevel)
- The `| head -1` picks first non-empty result automatically (super-repo root when in submodule, repo root otherwise)
- No stderr redirect (`2>/dev/null`) needed
- No conditional `test -z` check needed
- Simpler: 2 commands instead of 3
- Avoids bash parsing errors when combined with other operators (`;`, `&&`, `|`)
- Proven to work from both super-repo and submodules

### Files Changed
- `SKILL.md` lines 66-68: Updated "Step 0: Navigate to Repository Root"
- `SKILL.md` lines 89-91: Updated "Audit Single Skill" setup section
- `SKILL.md` line 94: Updated compatibility note to explain new pattern behavior
- `SKILL.md` line 311: Changed "Missing REPO_ROOT pattern" to "Missing repository root pattern"
- `references/common-failure-patterns.md` lines 107-120: Updated "Missing cd REPO_ROOT pattern" section with new approach

### Reason
- **Problem**: Complex 3-line pattern caused bash parsing errors and was difficult to maintain
- **Solution**: Industry-standard git pattern used across command files and MCP tools
- **Impact**: More reliable, easier to understand, consistent with project conventions

### Testing
- ✅ Pattern tested from submodule directory (modules/chariot/ui/src/)
- ✅ Pattern tested from super-repo root
- ✅ No bash parsing errors

### Method
- Updated via Edit tool following TDD workflow (RED-GREEN-REFACTOR)
- Backup created: `.local/SKILL.md.backup-20251231-*`

---

## [2025-12-30] - Add Phase 14d: Prose Phase References

### Added
- **Phase 14d: Prose Phase References** - Detects stale prose phase references after phase renumbering
- Implementation: `scripts/src/lib/phases/phase14d-prose-phase-references.ts` (~300 lines)
- Detailed reference: `references/phase-details.md` - Added Phase 14d section
- Registry update: Added to `phase-registry.ts` as validation-only phase

### Changed
- Phase count: 22 phases → 23 phases (22 + 4 sub-phases → 22 + 5 sub-phases)
- SKILL.md description: "22-phase audit" → "23-phase audit"
- Quick Reference table: "Full 22-phase audit" → "Full 23-phase audit"
- Validation-Only category: 14b-c → 14b-d
- Updated fixing-skills SKILL.md: Phases 14b-c → 14b-d in all references

### Reason
- **RED failure**: Audit doesn't detect stale prose references like "Phase 4 (implementation)" after phase renumbering
- **Real example**: orchestrating-feature-development has 5 stale references after Phase 2 (Discovery) insertion
- Phase 4 (Broken Links) only catches markdown link syntax `[Phase 3](phase-3-file.md)`
- Prose references like "Return to Phase 4 (implementation)" remain undetected

### Technical Details
**Detection Logic:**
1. Extracts canonical phase list from SKILL.md Quick Reference table or `## Phase N:` headings
2. Scans all skill files (SKILL.md + references/*) for prose patterns: `Phase N (name)` or `Phase N:`
3. Validates phase number exists and name hint matches canonical phase name
4. Excludes: `.history/CHANGELOG` (historical), code blocks, cross-skill references

**Output Format:**
```
Phase 14d: Prose Phase References
  WARNING: 5 stale phase reference(s) found

  troubleshooting.md:108 - 'Phase 4 (implementation)' - Phase 4 is now 'Architecture', implementation is Phase 5
  troubleshooting.md:286 - 'Phase 3 (architecture)' - Phase 3 is now 'Planning', architecture is Phase 4
```

**Severity:** WARNING (doesn't break functionality)
**Fix support:** Validation-Only - requires semantic understanding to fix correctly

### Files Changed
- `scripts/src/lib/phases/phase14d-prose-phase-references.ts` - NEW: Phase implementation
- `scripts/src/lib/phase-registry.ts` - Added Phase 14d import and registration
- `SKILL.md` - Updated phase count (22→23), updated Validation-Only phases (14b-c→14b-d)
- `references/phase-details.md` - Added Phase 14d section with examples
- `../fixing-skills/SKILL.md` - Updated Validation-Only category (14b-c→14b-d) in 3 locations

### Impact
**Success criteria:** Running audit on orchestrating-feature-development now detects 5 stale prose references that were previously missed.

## [2025-12-30] - Add Phase Numbering Hygiene Criterion

### Added
- **Criterion 7: Phase Numbering Hygiene** - New semantic review criterion that detects fractional major phase numbers
- Detailed reference file: `references/phase-numbering-hygiene.md` (~200 lines)
- Detection pattern: Scans for `## Phase X.Y` or `## Step X.Y` in headings
- Distinguishes major phases (flag WARNING) from acceptable sub-steps (e.g., `### Step 7.1`)

### Changed
- Semantic Review Checklist: 6 criteria → 7 criteria
- Added "Phase Numbering Hygiene Assessment" subsection in SKILL.md
- Updated `references/semantic-review-output.md`: "6 criteria" → "7 criteria"
- Line count: 308 → 322 lines (still well under 500 limit)

### Reason
- **RED failure**: No audit criterion detects fractional phase numbering (Phase 3.5, Phase 5.4)
- Historical evidence: `creating-skills` CHANGELOG references Phase 5.3, 5.4, 2.3
- `managing-skills/references/patterns/changelog-format.md` line 7 references Phase 5.4
- `updating-skills` was just updated to mandate sequential integer numbering
- Fractional phases create maintenance debt and numbering confusion

### Technical Details
**Detection Logic:**
1. Scans SKILL.md and all files under `references/` directory
2. Regex pattern: `^##+ (Phase|Step) \d+\.\d+` in headings
3. Distinguishes fractional MAJOR phases (bad) from sub-steps (acceptable)
4. Sub-steps like `### Step 7.1` under `## Step 7` represent decomposition, not insertion

**Output Format:**
```json
{
  "severity": "WARNING",
  "criterion": "Phase Numbering Hygiene",
  "issue": "Fractional phase numbering detected: Phase 3.5 at line 45",
  "recommendation": "Renumber phases sequentially and update cross-references"
}
```

**Severity:** Always WARNING (not CRITICAL) - impacts maintainability but doesn't block functionality

### Files Changed
- `SKILL.md` - Added criterion 7 to checklist, added Phase Numbering Hygiene Assessment subsection
- `references/semantic-review-output.md` - Updated "6 criteria" to "7 criteria"
- `references/phase-numbering-hygiene.md` - NEW: Detection logic, examples, output format

### Impact
- Claude will now flag fractional phase numbers during semantic review
- Complements `updating-skills` Phase Numbering Rule
- Prevents accumulation of fractional phases in future skill updates
- Coordinated with pending `fixing-skills` update for automated remediation

### Related Updates
- Part of 4-skill update sequence:
  1. ✅ `updating-skills` - Added Phase Numbering Rule
  2. ✅ `auditing-skills` - Added detection criterion (this update)
  3. ⏳ `fixing-skills` - Add fix guidance
  4. ⏳ `managing-skills` - Fix stale Phase 5.4 reference

### Method
- Manual edit via Edit and Write tools
- Backup created: `.local/2025-12-30-*-auditing-skills-pre-phase-numbering-hygiene.bak`

---

## [2025-12-28] - Mandatory Description Quality Assessment

### Changed
- **INSTRUCTION-BASED ENFORCEMENT**: Added explicit, mandatory Description Quality Assessment instructions to semantic review
  - Before: Vague checklist item "Description Quality (CSO)" with no concrete criteria
  - After: Dedicated subsection with 5-criteria evaluation framework (Accuracy, Completeness, Specificity, Discoverability, Honesty)
  - Impact: Transforms description quality from "easy to skip" to "impossible to bypass"

### Technical Details
- Updated "Semantic Review Checklist" to mark Description Quality as "MANDATORY detailed assessment (see section below)"
- Added new subsection "Description Quality Assessment (MANDATORY)" with brief summary + link
- Full 5-criteria framework extracted to `references/description-quality-assessment.md`:
  - 5-criteria evaluation table with specific questions and failure examples
  - Step-by-step assessment instructions
  - JSON output format for findings
  - Concrete examples of issues to report (4 examples)
  - Severity guidance table
- Added enforcement statement before "END OF TASK": "⚠️ AUDIT IS INCOMPLETE if you skip Description Quality Assessment"

### Why This Matters
The deleted `phase1b-description-quality.ts` was "fantasy code" that expected Claude to magically populate quality issues during TypeScript execution. Real enforcement requires explicit instructions that Claude must follow during semantic review.

**Description quality = skill discoverability.** A skill with poor description is an invisible skill.

### Files Modified
- `SKILL.md` - Reduced from 2286 to 1438 words via progressive disclosure
- `references/description-quality-assessment.md` - NEW: Full 5-criteria framework (~70 lines)
- `references/semantic-review-output.md` - NEW: JSON format, severity levels, output contract (~75 lines)

### Extractions Applied
1. **Description Quality Assessment** - Full framework extracted, inline summary retained
2. **Semantic Review Output** - JSON examples, severity levels, output contract extracted
3. **Fix Workflow** - Detailed procedures removed, link to fixing-skills retained
4. **Fixing Issues subsection** - Shortened to link only
5. **Post-Audit Semantic Review** - Duplicate section removed

### Testing
- ✅ Word count: 1438 (under 1500 limit)
- ✅ Line count: 307 (under 500 limit)
- ✅ All existing semantic review structure preserved
- ✅ Reference files integrate with existing JSON output format

### User-Facing Changes
When performing semantic review, Claude will now:
1. Evaluate descriptions against 5 concrete criteria
2. Report specific issues with recommendations
