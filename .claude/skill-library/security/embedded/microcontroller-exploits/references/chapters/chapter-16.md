## []{#ch16.xhtml_page_157 .pagebreak}**16  nRF52 APPROTECT Glitch** {#ch16.xhtml_ch16 .h2a}

Access Port Protection (APPROTECT) is nRF52's replacement for the
nRF51's family's MPU-based protection features that we saw in [Chapter
9](#ch09.xhtml_ch09). It fixes the vulnerabilities of the older
platform, providing a debugging interface to unlocked chips but a very
limited interface to locked chips. On a locked chip, the debugger can do
little except erase all of memory, unlocking the chip but destroying any
secrets that might once have been in flash memory. A glitching attack
against APPROTECT was first described in two articles: Results (2020a)
and Results (2021b). The specific target of these papers was the
nRF52840, but the entire family is expected to be vulnerable.

Because these chips have no boot ROM, all peripherals are initialized in
hardware after reset, including the protection features. By using simple
power analysis on a scope to identify the time offset at which the
memory controller *disables* APPROTECT on an unlocked chip at startup,
he could then glitch at this moment to trick a locked chip into
disabling protections as if it were unlocked.

With the popularity of Apple's AirTags and a public pinout in O'Flynn
(2021) ([Figure 16.1](#ch16.xhtml_ch16fig1)), the nRF52 began to replace
the LPC11 family as the most glitched microcontroller in literature.
It's been dumped as a video tutorial (Roth (2021)) and a glitcher built
from an STM32 devkit (Melching (2021)) appeared within days. Practice
makes perfect, and my favorite glitcher for the nRF52 was published as
36 lines of Arduino ESP32 code in Christophel (2021) as a tweet!

::: image
[]{#ch16.xhtml_page_158
.pagebreak}![Image](images/f0158-01.jpg){#ch16fig1}

> **Description:** Photograph of a circular PCB board featuring 38 numbered LED positions arranged in a ring pattern. The board has mounting holes in the corners and multiple connector pads. The LEDs are numbered sequentially from 1-38 around the circumference. Three larger connector sections are visible at the top (positions near 38, 37) and bottom. This appears to be a LED ring or display board, possibly for persistence-of-vision effects or circular visualization applications.

:::

Figure 16.1: Apple AirTag Testpoints from O'Flynn (2021)

::: image
[]{#ch16.xhtml_page_159
.pagebreak}![Image](images/f0159-01.jpg){#ch16fig2}

> **Description:** Die photo of a microcontroller showing minimal logic circuitry concentrated in the upper left corner and lower right regions. The majority of the die area (center and right) appears as uniform gray, indicating large memory blocks or unused silicon space. Bond pads are arranged around the perimeter. The sparse layout suggests this is either a simple microcontroller with limited features or a chip with significant reserved/blank silicon area. The contrast between dense logic and empty space is striking.

:::

Figure 16.2: Nordic nRF52840

::: image
[]{#ch16.xhtml_page_160
.pagebreak}![Image](images/f0160-01.jpg){#ch16fig3}

> **Description:** Arduino/ESP32 code for nRF52 glitcher by Aaron Christophel, designed for use with airtag-dump client. The setup function initializes serial at 115200 baud and configures three pins: LED (pin 2) as output, GLITCHER (pin 5) as output for glitch injection, and NRF_POWER (pin 22) as output for power control. The loop monitors serial input and when 'g' is received, it triggers a glitch sequence by turning on LED and NRF_POWER, executing a glitch pulse, then turning everything off.

:::

Figure 16.3: A nRF52 Glitcher in a Tweet

[]{#ch17.xhtml}

