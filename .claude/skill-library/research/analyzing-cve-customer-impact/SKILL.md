---
name: analyzing-cve-customer-impact
description: Use when assessing CVE exposure for specific customers - correlates CVE affected products with customer asset inventory via Chariot CLI to determine impact
allowed-tools: Read, Write, Bash, Grep, Glob, TodoWrite, Skill, AskUserQuestion
---

# Analyzing CVE Customer Impact

**Correlate CVEs with customer asset inventory to assess exposure and prioritize remediation.**

## When to Use

Use this skill when:

- Customer asks: "Are we vulnerable to CVE-X?"
- Security bulletin released and you need to identify affected customers
- Threat intelligence report identifies CVEs and you need customer-specific impact
- Ad-hoc vulnerability triage: "Which customers are exposed to this 0-day?"
- Automated monitoring: Alert triggered ‚Üí instant customer impact check

**Key Principle:** This skill answers the question "Does this CVE affect assets this customer owns?" by querying the Chariot platform via praetorian CLI.

**You MUST use TodoWrite before starting to track all phases.**

## Quick Reference

| Phase | Purpose | Output |
|-------|---------|--------|
| 0. Account Discovery | Select customer account (if not provided) | Account identifier |
| 1. CVE Parsing | Extract affected products/versions/CPE | Product metadata |
| 2. Asset Discovery | Query via waterfall (CVE ID ‚Üí CPE) | Asset list from CLI |
| 3. Correlation | Match CVE products ‚Üí customer assets | Exposure analysis |
| 4. Impact Assessment | Prioritize by criticality + exposure | Impact report |

## Progress Tracking (MANDATORY)

**Create these todos at workflow start:**

```
0. "Discover and select customer account" (Phase 0 - if not provided)
1. "Parse CVE metadata for affected products/versions" (Phase 1)
2. "Query customer asset inventory via CLI" (Phase 2)
3. "Correlate CVE products with customer assets" (Phase 3)
4. "Generate impact assessment report" (Phase 4)
```

---

## Workflow Overview

### Input Parameters

Ask user via AskUserQuestion if not provided:

| Parameter | Required | Purpose |
|-----------|----------|---------|
| **CVE IDs** | Yes | One or more CVE identifiers (e.g., CVE-2025-20393) |
| **Customer/Account** | Yes | Chariot account or profile identifier |
| **Detail Level** | No | Summary (default) or Full (include asset details) |

### Output Artifacts

| Artifact | Location | Purpose |
|----------|----------|---------|
| **Impact Summary** | IMPACT.md | Executive summary of exposure |
| **Affected Assets** | IMPACT.md | List of vulnerable assets with severity |
| **Remediation Priority** | IMPACT.md | Ordered list by criticality + exposure |

---

## Phase 0: Account Discovery (If Customer Not Specified)

**Objective:** Identify target customer account from user's available accounts.

**Skip this phase if:** Customer/account already provided as parameter.

### 0.1 List Available Accounts

```bash
praetorian chariot list accounts
```

**Example output:**
```
#account#chariot+acme-corp@praetorian.com#user@praetorian.com#
#account#chariot+demo@praetorian.com#user@praetorian.com#
#account#chariot+intel@praetorian.com#user@praetorian.com#
```

### 0.2 Account Selection via AskUserQuestion

**Present user with options:**

```
Question: "Which customer account should I analyze for CVE impact?"
Options:
  1. {First account name} (e.g., "acme-corp")
  2. {Second account name} (e.g., "demo")
  3. {Third account name} (e.g., "intel")
  [... up to 4 options max]

Multi-select: false (single account only for this skill)
```

**If user has >4 accounts:** Show first 3 + "Other (specify manually)" option.

**For "All accounts" scenario:** Recommend using `/threat-report` command which orchestrates batch processing.

### 0.3 Validate Account and Asset Inventory

Verify selected account exists and has assets:

```bash
ASSET_CHECK=$(praetorian --account "<selected-account>" chariot list assets --page first 2>&1)

# Check for errors
echo "$ASSET_CHECK" | grep -q "error" && echo "INVALID ACCOUNT" && exit 1

# Check for empty inventory
ASSET_COUNT=$(echo "$ASSET_CHECK" | wc -l)
if [ "$ASSET_COUNT" -eq 0 ]; then
  echo "Zero assets in account - impact analysis will show no exposure"
fi
```

**If invalid account:** Re-prompt with corrected account list.

**If zero assets:** Proceed with analysis, report will show "No asset inventory - cannot assess exposure."

---

## Phase 1: CVE Metadata Parsing

**Objective:** Extract affected product/version information and CPE identifiers from CVE sources.

### 1.1 Query CVE Databases

For each CVE ID, retrieve metadata from NVD, CISA KEV, and vendor advisories.

**See:** [references/cve-data-sources.md](references/cve-data-sources.md) for query patterns and field extraction.

### 1.2 Extract Critical Fields

Parse CVE data to extract:
- **CPE identifiers** (e.g., `cpe:2.3:a:microsoft:sharepoint_server:2019:*`)
- **Vendor/Product** (normalized names)
- **Affected versions** (ranges)
- **CVSS severity**
- **Exploitation status** (KEV, PoC, etc.)

---

## Phase 2: Customer Asset Discovery

**Objective:** Query Chariot platform for customer asset inventory using waterfall approach.

### 2.1 Waterfall Search Strategy

**Use computational-efficient waterfall approach:**

```
Path 1: CVE ID Search (FAST ‚ö° - Try First)
  ‚îî‚îÄ> Search existing risks by CVE ID
  ‚îî‚îÄ> Chariot has already detected vulnerability
  ‚îî‚îÄ> Returns confirmed vulnerable assets

Path 2: CPE Search (SLOW üêå - Fallback)
  ‚îî‚îÄ> Search by product CPE identifiers
  ‚îî‚îÄ> Chariot has product detection but no CVE detection
  ‚îî‚îÄ> Returns potentially vulnerable assets (requires validation)
```

### 2.2 Path 1: CVE ID Search (Fast Path)

Search for risks by CVE ID: `praetorian chariot search --term "name:CVE-ID" --kind risk`

**If results found:** ‚úÖ Confirmed vulnerable, extract asset IDs, **STOP HERE**

**See:** [references/search-implementation-patterns.md](references/search-implementation-patterns.md) for parsing details and error handling

### 2.3 Path 2: CPE Search (Fallback - Detection Gap)

**Only use if Path 1 returns zero results.**

**Steps:**
1. Extract CPE from Phase 1 CVE metadata
2. Search: `praetorian chariot search --term "name:vendor:product" --kind attribute --page first`
3. Parse CPE attributes (limit: 100 assets)
4. Add "Potentially Vulnerable" disclaimer

**See:** [references/search-implementation-patterns.md](references/search-implementation-patterns.md) for CPE parsing, result limiting, and timeout handling

---

## Phase 3: CVE-Asset Correlation

**Objective:** Validate and enrich asset data from Phase 2 discovery.

### 3.1 Correlation by Search Path

**Path 1 (CVE ID Search) - High Confidence:**
- Assets from risks are **confirmed vulnerable**
- No additional correlation needed
- Mark confidence: **CONFIRMED**

**Path 2 (CPE Search) - Medium Confidence:**
- Assets from CPE attributes are **potentially vulnerable**
- Requires version validation (if available)
- Mark confidence: **POTENTIAL (requires validation)**

### 3.2 Version Validation (Path 2 Only)

**When CPE includes version information:**

```bash
# Get detailed CPE attribute
praetorian --account "<customer>" chariot get attribute "#attribute#cpe#..."
```

**Parse CPE version:**
- Format: `cpe:2.3:a:vendor:product:version:update:edition:language:sw_edition:target_sw:target_hw:other`
- Extract version field (position 5)
- Compare against CVE affected version range

**Examples:**

```
CVE affects: SharePoint 2019 (all versions)
Asset CPE: cpe:2.3:a:microsoft:sharepoint_server:2019:*:*:*:*:*:*:*
Result: ‚úÖ MATCH (version in affected range)

CVE affects: SharePoint 2016-2019
Asset CPE: cpe:2.3:a:microsoft:sharepoint_foundation:2013:*:*:*:*:*:*:*
Result: ‚ùå NO MATCH (2013 not in affected range)
```

### 3.3 Asset Enrichment with Risk Metadata

**For Path 1 (CVE ID search) - Enrich with risk details:**

For each asset identified via risks, get full risk metadata:

```bash
RISK_DATA=$(praetorian --account "<customer>" chariot get risk "{risk-key}" 2>&1)

# Handle failures gracefully
if echo "$RISK_DATA" | grep -q "error"; then
  echo "Risk metadata unavailable - using basic data only"
  STATUS="UNKNOWN"
else
  STATUS=$(echo "$RISK_DATA" | jq -r '.status')
fi
```

**Extract metadata (when available):**
- **Risk Status:** OH/OM/TC/AH/etc. (see [references/risk-status-codes.md](references/risk-status-codes.md))
- **Created Date:** When vulnerability was first detected
- **Updated/History:** Triage actions, if available

**If metadata unavailable:** Use asset identifier only, mark status as "UNKNOWN - metadata unavailable"

**Categorize by remediation status:**
- **Open (OH/OM/OL):** Vulnerable, not yet addressed
- **Triaged (TC/TI):** Vulnerable, remediation in progress
- **Addressed (AH/AM/AL):** Previously vulnerable, now fixed
- **UNKNOWN:** Metadata retrieval failed, assume vulnerable

**For Path 2 (CPE search) - Basic enrichment only:**
- No risk metadata (detection gap)
- Asset data only (key, name, class)
- Mark as POTENTIAL

---

## Phase 4: Impact Assessment & Detection Status Refinement

**Objective:** Prioritize affected assets and refine detection status based on customer exposure.

### 4.1 Detection Status Refinement

**Update status from Phase 1 based on customer asset exposure:**

| Phase 1 Status | Customer Assets | Phase 2 Refined Status | Symbol | Priority |
|----------------|----------------|----------------------|--------|----------|
| COVERED | Assets affected | **COVERED-EXPOSED** | ‚ö†Ô∏è üü° | MEDIUM |
| COVERED | No assets | **COVERED** | ‚úÖ üü¢ | LOW |
| GAP | Assets affected | **GAP** (critical) | ‚ùå üî¥ | CRITICAL |
| GAP | No assets | **GAP** (lower priority) | ‚ùå üî¥ | HIGH |

**Progressive status will be further refined in Phase 3 when gap remediation is triggered.**

**See:** [Detection Status System](references/detection-status-system.md) for complete definitions.

### 4.2 Impact Scoring

Rank affected assets using combined scoring:

| Factor | Weight | Scoring |
|--------|--------|---------|
| **CVE Severity** | 40% | CVSS score (10 = max priority) |
| **Exploitation Status** | 30% | KEV/Public exploit (10) > PoC (7) > None (3) |
| **Asset Criticality** | 20% | Production (10) > Staging (5) > Dev (1) |
| **Exposure Level** | 10% | Internet-facing (10) > Internal (5) |

**Asset criticality** can be inferred from:
- Asset name (e.g., "prod-api" vs "dev-test")
- Domain TLD (e.g., ".com" vs ".internal")
- Asset status (Active = higher priority)

### 4.3 Generate Impact Report with Refined Detection Status

**Format:**

```markdown
# CVE Customer Impact Assessment

**Customer:** {customer-name}
**CVEs Analyzed:** {count}
**Assets Scanned:** {total-assets}
**Vulnerable Assets:** {affected-count}
**Detection Method:** {Path 1: CVE Detection | Path 2: CPE Matching}

---

## Executive Summary

{1-2 sentence summary of findings with refined detection status context}

---

## Critical Findings

| CVE | Total Assets | Open | Triaged | Addressed | Detection Status | Priority |
|-----|--------------|------|---------|-----------|------------------|----------|
| CVE-2025-20393 | 3 | 2 | 1 | 0 | ‚ùå GAP (üî¥ CRITICAL) | P0 |
| CVE-2025-55182 | 12 | 8 | 3 | 1 | ‚ö†Ô∏è COVERED-EXPOSED (üü°) | P1 |
| CVE-2025-14733 | 0 | 0 | 0 | 0 | ‚úÖ COVERED (üü¢ LOW) | P3 |

**Risk Status Breakdown:**
- **Open:** Not yet addressed (OH/OM/OL) - Immediate action required
- **Triaged:** Remediation in progress (TC/TI) - Customer working on it
- **Addressed:** Fixed and verified (AH/AM/AL) - Safe

**Detection Status Legend:**
- ‚ùå **GAP** (üî¥): No template + Assets exposed
- ‚ö†Ô∏è **COVERED-EXPOSED** (üü°): Template exists + Assets exposed
- ‚úÖ **COVERED** (üü¢): Template exists + No exposure
- üî∂ **IN DEVELOPMENT** (üü†): Gap + Research triggered (Phase 3)

**See:** [references/risk-status-codes.md](references/risk-status-codes.md) for complete status definitions

---

## Affected Asset Details

**For each CVE, document:**
- Detection method (Path 1: CVE ID or Path 2: CPE)
- Refined detection status (with customer exposure context)
- Confidence level (CONFIRMED or POTENTIAL)
- List of affected/potentially affected assets
- Business impact assessment
- Remediation recommendations

**See:** [references/report-examples.md](references/report-examples.md) for detailed format examples with all status types.

---

## No Exposure Found

List CVEs where customer has no affected assets with detection method used
```

### 4.3 Output Location

Write impact assessment to:

```bash
ROOT="$(git rev-parse --show-superproject-working-tree --show-toplevel | head -1)"
TIMESTAMP=$(date +"%Y-%m-%d-%H%M%S")
CUSTOMER="${CUSTOMER_NAME:-unknown}"
OUTPUT_DIR="$ROOT/.claude/.output/cve-impact/${TIMESTAMP}-${CUSTOMER}"
mkdir -p "$OUTPUT_DIR"
# Write IMPACT.md to OUTPUT_DIR
```

---

## Validation Checklist

- [ ] CVE metadata + CPE extracted (Phase 1)
- [ ] Account selected/validated (Phase 0)
- [ ] Path 1 (CVE ID) attempted first (Phase 2)
- [ ] Path 2 (CPE) executed if Path 1 failed
- [ ] Risk metadata enriched (Path 1 only)
- [ ] Detection status refined by customer exposure (Phase 4)
- [ ] Risk status breakdown (Open/Triaged/Addressed) calculated
- [ ] IMPACT.md written with risk metadata
- [ ] All TodoWrite items marked complete

---

## Common Rationalizations (DO NOT SKIP)

| Rationalization | Why It's Wrong |
|----------------|----------------|
| "Customer has no exposed assets, skip CLI query" | Must verify with CLI, don't assume from prior knowledge |
| "CVE is old, customer probably patched" | Asset inventory shows current state, not assumptions |
| "No CVE risks found, skip CPE search" | Path 2 (CPE) is mandatory fallback for detection gaps |
| "CPE search takes too long, skip it" | CPE search is only Path 2 fallback, ~10-30 seconds |
| "No exact product match, skip asset" | Partial matches may indicate exposure, flag for review |
| "Version info missing, mark as safe" | Absence of version = cannot confirm safety, flag as POTENTIAL |
| "Only 1 asset affected, not worth reporting" | Single critical asset may have high business impact |
| "Skip Path 1, go straight to CPE" | Path 1 is faster AND more accurate, always try first |
| "Mark Path 2 results as CONFIRMED" | Path 2 = POTENTIAL only, requires manual validation |

---

## Integration

### Called By

- `/threat-report` command - For all CVEs in threat intel report
- Manual invocation - Ad-hoc customer impact inquiries
- Automated monitoring - Alert-triggered impact checks

### Requires (invoke before starting)

None - standalone skill

### Calls (during execution)

| Skill | Phase | Purpose |
|-------|-------|---------|
| `mcp-tools-praetorian-cli` | Phase 2 | Token-efficient CLI queries |

### Pairs With (conditional)

| Skill | Trigger | Purpose |
|-------|---------|---------|
| `orchestrating-cve-research-jobs` | High-impact CVE without nuclei template | Trigger research |
| `generating-threat-intelligence-reports` | Part of full threat intel workflow | Provide CVE context |

---

## Related Skills

| Skill | Purpose |
|-------|---------|
| `mcp-tools-praetorian-cli` | CLI wrapper for token-efficient queries |
| `generating-threat-intelligence-reports` | Threat intelligence research |
| `orchestrating-cve-research-jobs` | CVE Researcher job orchestration |

---

## Changelog

See `.history/CHANGELOG` for version history.
