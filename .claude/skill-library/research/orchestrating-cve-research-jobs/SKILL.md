---
name: orchestrating-cve-research-jobs
description: Use when triggering CVE Researcher jobs for detection capability development - orchestrates job creation, monitors status, tracks PR and Linear ticket generation
allowed-tools: Read, Write, Bash, Grep, Glob, TodoWrite, AskUserQuestion
---

# Orchestrating CVE Research Jobs

**Automate CVE Researcher job creation and tracking for detection capability development.**

## When to Use

Use this skill when:

- Detection gap identified (CVE without nuclei template)
- Need detailed CVE analysis for capability development
- Multiple CVEs require research in parallel
- Tracking CVE research pipeline status
- Automating capability development workflow

**Key Principle:** This skill triggers and monitors the CVE Researcher agent to automate template creation, PR generation, and Linear ticket tracking.

**You MUST use TodoWrite before starting to track all phases.**

## Quick Reference

| Phase                | Purpose                        | Output             |
| -------------------- | ------------------------------ | ------------------ |
| 1. Job Creation      | Trigger CVE Researcher via CLI | Job IDs            |
| 2. Status Monitoring | Poll job completion status     | Job status         |
| 3. Output Tracking   | Capture PRs and Linear tickets | Research artifacts |
| 4. Report Generation | Summarize research pipeline    | Tracking report    |

## Progress Tracking (MANDATORY)

**Create these todos at workflow start:**

```
1. "Create CVE Researcher jobs via praetorian CLI" (Phase 1)
2. "Monitor job status and completion" (Phase 2)
3. "Track PR and Linear ticket generation" (Phase 3)
4. "Generate research tracking report" (Phase 4)
```

---

## Workflow Overview

### Input Parameters

Ask user via AskUserQuestion if not provided:

| Parameter                 | Required | Purpose                        | Default |
| ------------------------- | -------- | ------------------------------ | ------- |
| **CVE IDs**               | Yes      | One or more CVE identifiers    | N/A     |
| **Detailed Analysis**     | No       | Include verbose output         | true    |
| **Create PRs**            | No       | Generate nuclei template PRs   | true    |
| **Create Linear Tickets** | No       | Track in Linear                | true    |
| **Days Limit**            | No       | Research freshness (1-30 days) | 1       |

### Output Artifacts

| Artifact           | Location         | Purpose                 |
| ------------------ | ---------------- | ----------------------- |
| **Job Summary**    | RESEARCH-JOBS.md | Job IDs and status      |
| **PR Links**       | RESEARCH-JOBS.md | Generated pull requests |
| **Linear Tickets** | RESEARCH-JOBS.md | Tracking tickets        |

---

## Phase 1: CVE Researcher Job Creation

**Objective:** Trigger CVE Researcher jobs via praetorian CLI for each CVE.

### 1.1 Authenticate CLI

Ensure praetorian CLI is configured:

```bash
# Verify authentication
praetorian chariot list assets --limit 1 2>&1 | grep -q "error" && echo "AUTH REQUIRED" || echo "AUTH OK"

# If authentication required:
praetorian configure
```

### 1.2 Create CVE Researcher Jobs

For each CVE ID, create a research job:

```bash
# NOTE: Key must be empty for cve-researcher-agent (target: "noinput")
praetorian --account "<customer>" chariot add job \
    --key "" \
    --capability cve-researcher-agent \
    --config '{
        "days":"1",
        "cve_id":"'${CVE_ID}'",
        "format":"text",
        "detailed":"true",
        "verbose":"true",
        "run_pipeline":"true",
        "run_validation":"false",
        "create_prs":"true",
        "create_linear_ticket":"true"
    }'
```

**Parameters explained:**

| Parameter              | Value          | Purpose                                           |
| ---------------------- | -------------- | ------------------------------------------------- |
| `days`                 | 1              | Research sources from last 24 hours (fresh intel) |
| `cve_id`               | CVE-YYYY-NNNNN | Target CVE for research                           |
| `format`               | text           | Output format (text vs JSON)                      |
| `detailed`             | true           | Include full analysis                             |
| `verbose`              | true           | Debug output for troubleshooting                  |
| `run_pipeline`         | true           | Execute full research pipeline                    |
| `run_validation`       | false          | Skip validation (faster, for batch jobs)          |
| `create_prs`           | true           | Auto-generate nuclei template PRs                 |
| `create_linear_ticket` | true           | Create tracking ticket in Linear                  |

**Capture job keys:**

```bash
# Note: Job creation with empty --key "" generates auto-timestamped key
# Job key format: #job##YYYY-MM-DDTHH:MM:SSZ#cve-researcher-agent

# List recent CVE Researcher jobs to get keys
praetorian --account "<customer>" chariot list jobs --page first | grep "cve-researcher-agent" > job_keys.txt
```

### 1.3 Batch Job Creation

For multiple CVEs, create jobs in parallel:

```bash
CVE_LIST=("CVE-2025-20393" "CVE-2025-14733" "CVE-2025-59718")

for CVE in "${CVE_LIST[@]}"; do
  echo "Creating job for $CVE..."
  praetorian --account "<customer>" chariot add job \
      --key "" \
      --capability cve-researcher-agent \
      --config "{\"cve_id\":\"${CVE}\",\"days\":\"1\",\"create_prs\":\"true\",\"create_linear_ticket\":\"true\",\"run_pipeline\":\"true\"}" &
done

wait  # Wait for all parallel jobs to complete
```

---

## Phase 2: Job Status Monitoring

**Objective:** Poll job completion and capture results.

### 2.1 Query Job Status

Use praetorian CLI to check job status:

```bash
# List jobs with status filter
praetorian chariot list jobs --prefix "#cve-research-"

# Get specific job details
praetorian chariot get job --key "$JOB_KEY"
```

**Job status format:** `{CODE}#{timestamp}`

**Status codes:**

- `JQ` - Job Queued (waiting to start)
- `JR` - Job Running (in progress)
- `JF` - Job Finished (completed successfully)
- `JX` - Job Failed (encountered error)

### 2.2 Wait for Completion (With Timeout)

Poll jobs until completion with timeout handling.

**See:** [references/job-monitoring-patterns.md](references/job-monitoring-patterns.md) for detailed polling implementations.

**Summary:**

- Single job: 30-minute timeout (60 iterations Ã— 30s)
- Batch jobs: 45-minute timeout (45 iterations Ã— 60s)
- Timeout triggers manual monitoring fallback

### 2.3 Extract Job Results

Once completed, retrieve job output:

```bash
# Get job result
praetorian chariot get job --key "$JOB_KEY" | jq -r '.result'

# If result includes PR URL, Linear ticket, etc.
PR_URL=$(praetorian chariot get job --key "$JOB_KEY" | jq -r '.result.pr_url')
LINEAR_TICKET=$(praetorian chariot get job --key "$JOB_KEY" | jq -r '.result.linear_ticket')
```

---

## Phase 3: Output Tracking

**Objective:** Capture generated PRs and Linear tickets for tracking.

### 3.1 Extract PR Links (Successful Jobs Only)

CVE Researcher creates PRs in nuclei-templates repository:

```bash
# Only extract from JF (finished) jobs, not JX (failed)
for JOB_KEY in $(cat job_keys.txt); do
  JOB_DATA=$(praetorian --account "<customer>" chariot get job "$JOB_KEY")
  STATUS_CODE=$(echo "$JOB_DATA" | jq -r '.status' | cut -d'#' -f1)

  if [[ "$STATUS_CODE" == "JF" ]]; then
    CVE=$(echo "$JOB_DATA" | jq -r '.config.cve_id')
    PR=$(echo "$JOB_DATA" | jq -r '.result.pr_url // "N/A"')
    echo "$CVE,$PR" >> pr_tracking.csv
  fi
done
```

### 3.2 Extract Linear Tickets (Successful Jobs Only)

CVE Researcher creates Linear tickets for tracking:

```bash
# Only extract from JF (finished) jobs
for JOB_KEY in $(cat job_keys.txt); do
  JOB_DATA=$(praetorian --account "<customer>" chariot get job "$JOB_KEY")
  STATUS_CODE=$(echo "$JOB_DATA" | jq -r '.status' | cut -d'#' -f1)

  if [[ "$STATUS_CODE" == "JF" ]]; then
    CVE=$(echo "$JOB_DATA" | jq -r '.config.cve_id')
    TICKET=$(echo "$JOB_DATA" | jq -r '.result.linear_ticket // "N/A"')
    echo "$CVE,$TICKET" >> linear_tracking.csv
  fi
done
```

### 3.3 Identify Failures

Track jobs that failed:

```bash
for JOB_KEY in $(cat job_keys.txt); do
  JOB_DATA=$(praetorian --account "<customer>" chariot get job "$JOB_KEY")
  STATUS=$(echo "$JOB_DATA" | jq -r '.status')
  STATUS_CODE="${STATUS%%#*}"

  if [[ "$STATUS_CODE" == "JX" ]]; then
    CVE=$(echo "$JOB_DATA" | jq -r '.config.cve_id')
    ERROR=$(echo "$JOB_DATA" | jq -r '.error // "Unknown error"')

    echo "$CVE,$ERROR" >> failed_jobs.csv
  fi
done
```

---

## Phase 4: Research Tracking Report with Detection Status Updates

**Objective:** Generate comprehensive tracking report and update detection status to IN DEVELOPMENT.

### 4.1 Update Detection Status

**For each CVE with research job created, update status from Phase 2:**

| Phase 2 Status | Customer Exposure | Phase 3 Updated Status | Symbol | Color     |
| -------------- | ----------------- | ---------------------- | ------ | --------- |
| GAP            | Assets affected   | **IN DEVELOPMENT**     | ðŸ”¶     | ðŸŸ  Orange |
| GAP            | No assets         | **IN DEV-NO EXPOSURE** | ðŸ”¶     | ðŸŸ¢ Green  |

**Include status evolution note in report:**

```
Detection status updated: GAP (ðŸ”´) â†’ IN DEVELOPMENT (ðŸŸ )
CVE Researcher job triggered - nuclei template development in progress.
Expected completion: 10-30 minutes. PR and Linear ticket will be auto-generated.
```

### 4.2 Report Format

```markdown
# CVE Research Job Tracking

**Date:** {timestamp}
**CVEs Processed:** {count}
**Jobs Created:** {total-jobs}
**Jobs Completed:** {completed-count}
**Jobs Failed:** {failed-count}

**Detection Status Updates:**

- {count} CVEs transitioned from âŒ GAP â†’ ðŸ”¶ IN DEVELOPMENT

---

## Active Research Jobs

| CVE            | Detection Status       | Job Status | PR      | Linear Ticket | Started  |
| -------------- | ---------------------- | ---------- | ------- | ------------- | -------- |
| CVE-2025-20393 | ðŸ”¶ IN DEVELOPMENT (ðŸŸ ) | RUNNING    | Pending | Pending       | 23:30:00 |

## Completed Research Jobs

| CVE            | Detection Status           | Job Status | PR Created                         | Linear Ticket                      | Completion Time  |
| -------------- | -------------------------- | ---------- | ---------------------------------- | ---------------------------------- | ---------------- |
| CVE-2025-55182 | ðŸ”¶ IN DEV-NO EXPOSURE (ðŸŸ¢) | COMPLETED  | [PR #1235](https://github.com/...) | [CHAR-568](https://linear.app/...) | 2026-01-12 14:45 |

---

## Failed Research Jobs

| CVE            | Job Status | Error Message                     | Recommended Action       |
| -------------- | ---------- | --------------------------------- | ------------------------ |
| CVE-2025-14733 | FAILED     | Insufficient vendor documentation | Manual research required |

---

## Next Steps

1. **Review PRs:** {count} nuclei template PRs require code review
2. **Track in Linear:** {count} Linear tickets created for capability development
3. **Manual fallback:** {failed-count} CVEs require manual research

---

## Output Files

- PR tracking: `pr_tracking.csv`
- Linear tickets: `linear_tracking.csv`
- Failed jobs: `failed_jobs.csv`
```

### 4.2 Output Location

Write tracking report to:

```bash
ROOT="$(git rev-parse --show-superproject-working-tree --show-toplevel | head -1)"
TIMESTAMP=$(date +"%Y-%m-%d-%H%M%S")
OUTPUT_DIR="$ROOT/.claude/.output/cve-research-jobs/${TIMESTAMP}"
mkdir -p "$OUTPUT_DIR"
# Write RESEARCH-JOBS.md to OUTPUT_DIR
```

---

## Validation Checklist

Before marking workflow complete:

- [ ] CVE Researcher jobs created for all CVE IDs (Phase 1)
- [ ] Job IDs captured and tracked
- [ ] Job status monitored until completion (Phase 2)
- [ ] Completed jobs verified (status = COMPLETED)
- [ ] PR links extracted from job results (Phase 3)
- [ ] Linear tickets extracted from job results
- [ ] Failed jobs identified with error messages
- [ ] Research tracking report generated (Phase 4)
- [ ] RESEARCH-JOBS.md written to OUTPUT_DIR
- [ ] All TodoWrite items marked complete

---

## Common Rationalizations (DO NOT SKIP)

| Rationalization                       | Why It's Wrong                                          |
| ------------------------------------- | ------------------------------------------------------- |
| "Just 1 CVE, don't need tracking"     | Single CVE still requires PR/Linear tracking            |
| "Jobs take too long, skip monitoring" | Must confirm completion to verify PRs created           |
| "Assume all jobs succeed"             | Jobs may fail due to vendor data gaps                   |
| "Skip Linear ticket creation"         | Tickets enable capability development tracking          |
| "Manual PR creation is faster"        | CVE Researcher automates research + template generation |
| "Don't wait for completion"           | Async jobs require polling to capture results           |

---

## Troubleshooting

### Job Creation Fails

**Error:** `Invalid capability: cve-researcher-agent`

**Solution:**

```bash
# Verify capability exists
praetorian chariot list capabilities | grep cve-researcher

# If missing, capability may not be deployed to account
# Contact platform team
```

### Job Stuck in PENDING

**Error:** Job never transitions from PENDING to RUNNING

**Solution:**

```bash
# Check job queue depth
praetorian chariot list jobs --status PENDING | wc -l

# If queue is large (>100), jobs may be throttled
# Wait longer or reduce parallel job creation
```

### No PR Created

**Error:** Job COMPLETED but no PR URL in result

**Solution:**

```bash
# Verify config included create_prs=true
praetorian chariot get job --key "$JOB_KEY" | jq '.config.create_prs'

# If false, recreate job with correct config
```

---

## Integration

### Called By

- `/threat-report` command - For detection gaps identified in threat intel report
- Manual invocation - Ad-hoc CVE research requests
- Automated workflows - Scheduled capability development

### Requires (invoke before starting)

None - standalone skill

### Calls (during execution)

None - uses praetorian CLI directly

### Pairs With (conditional)

| Skill                                    | Trigger                   | Purpose                   |
| ---------------------------------------- | ------------------------- | ------------------------- |
| `generating-threat-intelligence-reports` | Detection gaps identified | Trigger research for gaps |
| `analyzing-cve-customer-impact`          | High-impact CVE found     | Prioritize research       |

---

## Related Skills

| Skill                                    | Purpose                      |
| ---------------------------------------- | ---------------------------- |
| `generating-threat-intelligence-reports` | Threat intelligence research |
| `analyzing-cve-customer-impact`          | Customer exposure analysis   |

---

## Changelog

See `.history/CHANGELOG` for version history.
