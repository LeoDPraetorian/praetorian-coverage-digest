# Changelog

All notable changes to the orchestrating-feature-development skill will be documented in this file.

## [Date: 2025-12-30]

### Added - Phase 2: Discovery (MAJOR WORKFLOW ADDITION)
- **New Phase 2: Discovery** - Parallel pattern analysis using code-pattern-analyzer agents
- **Workflow expanded from 9 phases to 10 phases** with discovery phase insertion
- **Phase numbering renumbered**: All phases after Brainstorming shifted by +1
  - Phase 2: Planning → Phase 3: Planning
  - Phase 3: Architecture → Phase 4: Architecture
  - Phase 4: Implementation → Phase 5: Implementation
  - Phase 5: Code Review → Phase 6: Code Review
  - Phase 6: Test Planning → Phase 7: Test Planning
  - Phase 7: Testing → Phase 8: Testing
  - Phase 8: Test Validation → Phase 9: Test Validation
  - Phase 9: Completion → Phase 10: Completion

### Changed
- **Phase 4 (Architecture)**: Now receives discovery reports as input and performs tech debt analysis
- **Human Checkpoints**: Updated to phases 1, 3, and 4 (was 1, 2, and 3)
- **metadata.json schema**: Added discovery phase tracking with frontend/backend completion flags
- **metadata.json schema**: Added architecture phase tech debt tracking fields
- **Feature Directory Structure**: Added frontend-discovery.md, backend-discovery.md, tech-debt-assessment.md
- **Agent Matrix**: Added Discovery column showing code-pattern-analyzer ×2 for all feature types
- **Exit Criteria**: Added discovery reports and tech debt registry requirements

### Discovery Phase Design
- **Execution**: PARALLEL - frontend and backend analyzers run simultaneously
- **Agents**: code-pattern-analyzer (frontend focus) + code-pattern-analyzer (backend focus)
- **Scope**: Frontend analyzer targets modules/*/ui/src/*, backend analyzer targets modules/*/backend/*
- **Tool**: Uses discovering-reusable-code skill methodology
- **Outputs**:
  - frontend-discovery.md - Frontend pattern analysis
  - backend-discovery.md - Backend pattern analysis
- **Checkpoint**: NO human checkpoint after discovery (feeds into Architecture phase)
- **Objective**: Discovery agents report patterns WITHOUT judgment - leads apply judgment in Phase 4

### Architecture Phase Enhancements (Phase 4)
- **New Inputs**: frontend-discovery.md + backend-discovery.md from Phase 2
- **New Responsibilities**:
  1. Read discovery reports
  2. Analyze pattern quality (good code vs tech debt)
  3. For each pattern: decide extend or refactor
  4. Propose refactoring plans for tech debt
  5. Output tech debt assessment
- **New Output**: tech-debt-assessment.md documenting tech debt findings
- **Tech Debt Registry**: Leads populate .claude/tech-debt-registry.md REGARDLESS of human decision
- **Human Checkpoint Enhanced**: Present tech debt findings with options:
  - A) Refactor (with plan)
  - B) Extend anyway (document debt)

### Tech Debt Registry Integration
- **Location**: .claude/tech-debt-registry.md (repository root)
- **Populated By**: Lead agents during Architecture phase (Phase 4)
- **Growth Pattern**: Organic accumulation over time across all features
- **Format**: Markdown with pattern name, location, identified date, feature ID, issue description, recommendation, status

### Reason
- **RED Failure**: Current workflow lacks pattern discovery phase, causing implementations to add special-casing (`if newFeature {}`) throughout codebase instead of extending existing patterns
- **Root Cause**: Developers don't know what reusable patterns exist before designing/implementing
- **Impact**: Code duplication, inconsistent patterns, tech debt accumulation
- **Solution**:
  1. New Discovery phase (Phase 2) performs exhaustive pattern search BEFORE planning
  2. Parallel execution (frontend + backend) handles large codebase context limits
  3. Leads receive discovery reports and assess tech debt in Architecture phase
  4. Tech debt registry grows organically as features discover problematic patterns
  5. Human decides extend vs refactor at Architecture checkpoint (not after discovery)

### Technical Details
- SKILL.md: Updated from 321 lines to ~355 lines (under 500-line limit)
- Quick Reference table: Updated with Phase 2 Discovery row
- Workflow diagram: Expanded to show Phase 2 with parallel agents
- Agent Matrix: Added Discovery column showing ×2 agents for all types
- All phase number references updated throughout document
- Related Skills: Added discovering-reusable-code reference

### Related Components
- `.claude/skills/discovering-reusable-code/SKILL.md` - Pattern discovery methodology
- `.claude/agents/research/code-pattern-analyzer.md` - Discovery agent implementation
- `.claude/tech-debt-registry.md` - Central tech debt tracking (NEW)

---

## [Date: 2025-12-28]

### Changed (MAJOR WORKFLOW REDESIGN)
- **Workflow expanded from 5 phases to 8 phases** with parallel agent execution
- **Phase 3 (Architecture)**: Now uses domain leads (frontend-lead, backend-lead) + security-lead in PARALLEL instead of architect + reviewer pattern
- **Phase numbering shifted**: Testing moved from Phase 5 to Phase 6
- **Agent matrix updated**: Uses new agent names (frontend-lead, backend-lead, frontend-reviewer, frontend-security, etc.)

### Added
- **Phase 0: Setup** - Create feature directory with semantic naming (YYYY-MM-DD-{feature-name})
- **Phase 5: Code Review (NEW)** - Parallel code + security reviewers with explicit feedback loop (MAX 1 RETRY)
- **Phase 7: Test Assessment (NEW)** - Quality gate using test-lead with feedback loop (MAX 1 RETRY)
- **Feedback Loop Pattern**: MAX 1 RETRY then escalate to user (no infinite loops)
- **Parallel Execution Rules**: MANDATORY for independent agents in single Task message
- **Feature Directory Structure**: Centralized outputs to `.claude/features/YYYY-MM-DD-{name}/`

### New Reference Files
- `references/phase-5-code-review.md` - Parallel reviewers + feedback loop workflow
- `references/phase-7-test-assessment.md` - Test quality gate workflow

### Updated Reference Files
- `references/phase-3-architecture.md` - Rewritten for frontend-lead + security-lead pattern
- `references/phase-4-implementation.md` - Updated references to new Phase 5
- `references/phase-6-testing.md` - Renamed from phase-5, updated for parallel test modes

### Reason
- **RED Failure**: Architecture phase ran frontend-lead alone without security assessment. Security-lead only involved later (or never), missing early security review.
- **Additional Gap**: No code review phase existed - implementation went directly to testing without quality gate.
- **Additional Gap**: No test assessment phase - tests were written but quality not validated.
- **Solution**:
  1. Security-lead always included in architecture (Phase 3), spawned in parallel
  2. New Code Review phase (Phase 5) with parallel code + security reviewers
  3. New Test Assessment phase (Phase 7) with quality gate
  4. MAX 1 RETRY feedback loops prevent infinite loops

### Technical Details
- SKILL.md: 299 lines (compliant)
- phase-3-architecture.md: 328 lines (compliant)
- phase-5-code-review.md: 303 lines (compliant)
- phase-6-testing.md: 293 lines (compliant)
- phase-7-test-assessment.md: 285 lines (compliant)
- All files under 500-line limit ✅

### Agent Matrix
| Type | Leads (Phase 3) | Developers (Phase 4) | Reviewers (Phase 5) | Testers (Phase 6) |
|------|-----------------|----------------------|---------------------|-------------------|
| Frontend | frontend-lead + security-lead | frontend-developer | frontend-reviewer + frontend-security | frontend-tester ×3 |
| Backend | backend-lead + security-lead | backend-developer | backend-reviewer + backend-security | backend-tester ×3 |
| Full-stack | All 4 leads | Both developers | All 4 reviewers | All 6 testers |

---

## [Date: 2025-12-22]

### Changed
- **Phase 3 (phase-3-architecture.md)**: Added Step 8 for handling `needs_review` status from architecture agents
- **Exit Criteria**: Updated to explicitly require handling of `needs_review` status before proceeding to Phase 4
- **File Organization**: Extracted conflict resolution examples to `references/conflict-resolution-examples.md` for better organization (reduced main file from 439 to 496 lines after adding Step 8)

### Added
- **Step 8: Check Architecture Review Status and Revise Plan if Needed**
  - Handles `status='needs_review'` from architect/reviewer agents
  - Provides loop-back mechanism to Phase 2 (planning) when critical issues found
  - Offers user choice: revise plan, proceed with risks documented, or get more details
  - Documents plan revision workflow with progress file updates
  - Includes risk documentation template for "proceed with risks" path
- **New reference file**: `references/conflict-resolution-examples.md` with state management and component structure examples

### Reason
- **RED Failure**: Phase 3 workflow only handled `status='blocked'` but NOT `status='needs_review'`. When reviewer returned critical issues with `needs_review` status, the workflow incorrectly proceeded to Phase 4 without revising the plan, causing developers to implement flawed designs.
- **Impact**: This created a gap where architecture quality issues identified during review were ignored, leading to preventable implementation problems.
- **Solution**: New Step 8 checks agent status codes and provides structured decision flow for handling critical architecture feedback before implementation begins.

### Technical Details
- Steps renumbered: Old Step 8 → Step 9, Old Step 9 → Step 10
- New Step 8 inserted between Step 7 (validation) and Step 9 (progress update)
- Exit criteria now explicitly checks for `status="complete"` NOT `"needs_review"` or `"blocked"`
- Supports both plan revision (loop back to Phase 2) and risk acceptance (document in architecture.md)
- Final file size: 496 lines (under 500-line hard limit)

### REFACTOR
**Pressure Tests Run:**
- Test 1: Time pressure + Sunk cost - Agent must use AskUserQuestion, cannot auto-proceed
- Test 2: Authority pressure + Economic stakes - Agent must use AskUserQuestion despite CTO approval

**Test Results:**
- ✅ PASSED: Step 8 mandates AskUserQuestion, blocks automatic proceed to Phase 4
- ✅ PASSED: No exception for authority overrides or business pressure
- ⚠️ POTENTIAL LOOPHOLE IDENTIFIED: Agent might rationalize "stakeholders already said proceed" as implicit user input

**Recommendation for Future Iteration:**
Consider adding explicit counter in Step 8: "CRITICAL: This step is MANDATORY regardless of prior stakeholder approval, CTO endorsement, or business urgency. needs_review status means NEW information emerged that requires informed user choice."

**Current Status:**
- Skill successfully prevents auto-proceed to Phase 4 when needs_review status present
- Mandatory AskUserQuestion ensures user sees critical issues
- Authority/urgency pressures do not provide bypass mechanism in current implementation

## 2025-12-29 - Add Phase 6: Test Planning

**Change**: Inserted new Phase 6 (Test Planning), renumbered subsequent phases

**Phases Updated**:
- Phase 6: Test Planning (NEW) - test-lead creates test-plan.md
- Phase 7: Testing (was Phase 6) - testers follow test-plan.md
- Phase 8: Test Validation (was Phase 7) - test-lead validates against plan
- Phase 9: Completion (was Phase 8)

**Rationale**:
- Context propagation: All prior artifacts flow into test planning
- Goal-driven testing: Tests verify feature meets original goals
- Security integration: Security scenarios become explicit test cases
- Proactive quality: Define "what good looks like" BEFORE testing
- Symmetry: lead plans → implementer builds → lead validates (matches architecture pipeline)

**Files Modified**:
- SKILL.md: Added Phase 6, updated Quick Reference, workflow diagram, directory structure
- references/phase-6-test-planning.md: NEW - test planning workflow
- references/phase-7-testing.md: Renamed from phase-6, added test-plan.md input
- references/phase-8-test-validation.md: Renamed from phase-7, changed to validation mode
- references/phase-5-code-review.md: Updated next phase references

**Test Plan Inputs** (Phase 6):
- design.md (feature goals)
- plan.md (acceptance criteria)
- architecture.md (component structure, verification points)
- security-assessment.md (security test scenarios)
- implementation-log.md (actual implementation)

**Test Plan Output**:
- test-plan.md with coverage targets, required tests, security test cases, acceptance criteria tests, anti-patterns to avoid

